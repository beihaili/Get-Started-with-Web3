# æ¯”ç‰¹å¸äº¤æ˜“è¿›é˜¶

![status](https://img.shields.io/badge/çŠ¶æ€-å·²å®Œæˆ-success)
![author](https://img.shields.io/badge/ä½œè€…-beihaili-blue)
![date](https://img.shields.io/badge/æ—¥æœŸ-2025--06-orange)
![difficulty](https://img.shields.io/badge/éš¾åº¦-ä¸­çº§-yellow)

> ğŸ’¡ è‡ªå­¦å…¥é—¨ `Web3` ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œä½œä¸ºä¸€ä¸ªåˆšåˆšå…¥é—¨ Web3 çš„æ–°äººï¼Œæ¢³ç†ä¸€ä¸‹æœ€ç®€å•ç›´è§‚çš„ `Web3` å°ç™½å…¥é—¨æ•™ç¨‹ã€‚æ•´åˆå¼€æºç¤¾åŒºä¼˜è´¨èµ„æºï¼Œä¸ºå¤§å®¶ä»å…¥é—¨åˆ°ç²¾é€š Web3 æŒ‡è·¯ã€‚æ¯å‘¨æ›´æ–° 1-3 è®²ã€‚
> 
> æ¬¢è¿å…³æ³¨æˆ‘çš„æ¨ç‰¹ï¼š[@bhbtc1337](https://twitter.com/bhbtc1337)
> 
> è¿›å…¥å¾®ä¿¡äº¤æµç¾¤è¯·å¡«è¡¨ï¼š[è¡¨æ ¼é“¾æ¥](https://forms.gle/QMBwL6LwZyQew1tX8)
> 
> æ–‡ç« å¼€æºåœ¨ GitHubï¼š[Get-Started-with-Web3](https://github.com/beihaili/Get-Started-with-Web3)
> 
> è´­ä¹°BTC/ETH/USDT ç­‰åŠ å¯†è´§å¸æ¨è [å¸å®‰](https://www.binance.com/zh-CN)[æ³¨å†Œé“¾æ¥](https://accounts.marketwebb.me/register?ref=39797374)

## ç›®å½•

- [å‰è¨€](#å‰è¨€)
- [å¤šé‡ç­¾åäº¤æ˜“](#å¤šé‡ç­¾åäº¤æ˜“)
- [éš”ç¦»è§è¯(SegWit)æŠ€æœ¯](#éš”ç¦»è§è¯segwitæŠ€æœ¯)
- [Taprootå‡çº§è¯¦è§£](#taprootå‡çº§è¯¦è§£)
- [å¤æ‚äº¤æ˜“ç±»å‹åˆ†æ](#å¤æ‚äº¤æ˜“ç±»å‹åˆ†æ)
- [åœ°å€æ ¼å¼æ¼”è¿›](#åœ°å€æ ¼å¼æ¼”è¿›)
- [é«˜çº§äº¤æ˜“åº”ç”¨](#é«˜çº§äº¤æ˜“åº”ç”¨)
- [å®æˆ˜æ¼”ç»ƒï¼šé«˜çº§äº¤æ˜“](#å®æˆ˜æ¼”ç»ƒé«˜çº§äº¤æ˜“)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
- [ç»“è¯­](#ç»“è¯­)

## å‰è¨€

åœ¨å‰ä¸€ç« ã€Šæ¯”ç‰¹å¸äº¤æ˜“åŸºç¡€ã€‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†æ¯”ç‰¹å¸äº¤æ˜“çš„åŸºæœ¬ç»„æˆã€UTXOæ¨¡å‹å’ŒP2PKHäº¤æ˜“ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿›å…¥æ›´é«˜çº§çš„é¢†åŸŸï¼Œæ¢ç´¢æ¯”ç‰¹å¸äº¤æ˜“ç³»ç»Ÿçš„å¼ºå¤§åŠŸèƒ½ã€‚

æœ¬ç« å°†æ·±å…¥è®²è§£ï¼š
- å¤šé‡ç­¾åäº¤æ˜“çš„å·¥ä½œåŸç†
- SegWitï¼ˆéš”ç¦»è§è¯ï¼‰æŠ€æœ¯å¦‚ä½•æå‡æ•ˆç‡
- Taprootå‡çº§å¸¦æ¥çš„éšç§å’ŒåŠŸèƒ½å¢å¼º
- å„ç§å¤æ‚äº¤æ˜“ç±»å‹çš„åº”ç”¨åœºæ™¯
- åœ°å€æ ¼å¼çš„æ¼”è¿›å†ç¨‹

è¿™äº›æŠ€æœ¯ä¸ä»…æå‡äº†æ¯”ç‰¹å¸çš„åŠŸèƒ½æ€§ï¼Œæ›´ä¸ºLayer 2è§£å†³æ–¹æ¡ˆï¼ˆå¦‚é—ªç”µç½‘ç»œï¼‰å¥ å®šäº†åŸºç¡€ã€‚

## å¤šé‡ç­¾åäº¤æ˜“

### ä»€ä¹ˆæ˜¯å¤šé‡ç­¾åï¼Ÿ

å¤šé‡ç­¾åï¼ˆMultiSigï¼‰æ˜¯ä¸€ç§éœ€è¦å¤šä¸ªç§é’¥ç­¾åæ‰èƒ½èŠ±è´¹èµ„é‡‘çš„æœºåˆ¶ï¼Œç±»ä¼¼äºé“¶è¡Œçš„è”åˆè´¦æˆ·æˆ–å…¬å¸çš„è´¢åŠ¡å®¡æ‰¹æµç¨‹ã€‚

### ğŸ”‘ ä¸åŒäº¤æ˜“ç±»å‹çš„ç­¾åè¦æ±‚

é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£äº†æœ€åŸºæœ¬çš„P2PKHäº¤æ˜“ã€‚ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥ç†è§£ä¸åŒäº¤æ˜“ç±»å‹éœ€è¦ä¸åŒç­¾åçš„åŸç†ã€‚

#### P2PKHï¼ˆä»˜æ¬¾ç»™å…¬é’¥å“ˆå¸Œï¼‰- å•ç­¾åäº¤æ˜“
```
ä¹‹å‰äº¤æ˜“è¾“å‡º: OP_DUP OP_HASH160 <Aliceçš„å…¬é’¥å“ˆå¸Œ> OP_EQUALVERIFY OP_CHECKSIG
å½“å‰äº¤æ˜“è¾“å…¥: <Aliceçš„ç­¾å> <Aliceçš„å…¬é’¥>
```
- âœ… **åªéœ€è¦1ä¸ªç­¾å**ï¼šå› ä¸ºä¹‹å‰äº¤æ˜“æŒ‡å®š"ä»˜æ¬¾ç»™Aliceçš„å…¬é’¥å“ˆå¸Œ"
- ğŸ”“ **è§£é”æ¡ä»¶**ï¼šæä¾›æ­£ç¡®çš„å…¬é’¥å’Œå¯¹åº”çš„ç§é’¥ç­¾åå³å¯
- ğŸ‘¤ **ä½¿ç”¨åœºæ™¯**ï¼šä¸ªäººé’±åŒ…ä¹‹é—´çš„è½¬è´¦

#### å¤šé‡ç­¾åäº¤æ˜“ - éœ€è¦å¤šä¸ªç­¾å
```
ä¹‹å‰äº¤æ˜“è¾“å‡º: OP_2 <å…¬é’¥1> <å…¬é’¥2> <å…¬é’¥3> OP_3 OP_CHECKMULTISIG (2-of-3å¤šç­¾)
å½“å‰äº¤æ˜“è¾“å…¥: OP_0 <ç­¾å1> <ç­¾å2> <èµå›è„šæœ¬>
```
- âš ï¸ **éœ€è¦å¤šä¸ªç­¾å**ï¼šå› ä¸ºä¹‹å‰äº¤æ˜“è®¾å®šäº†"éœ€è¦3ä¸ªå…¬é’¥ä¸­çš„ä»»æ„2ä¸ªç­¾å"
- ğŸ”“ **è§£é”æ¡ä»¶**ï¼šå¿…é¡»æä¾›è¶³å¤Ÿæ•°é‡çš„æœ‰æ•ˆç­¾å
- ğŸ¢ **ä½¿ç”¨åœºæ™¯**ï¼šä¼ä¸šèµ„é‡‘ç®¡ç†ã€æ‰˜ç®¡æœåŠ¡ã€å¢å¼ºå®‰å…¨æ€§

#### ä¸ºä»€ä¹ˆç­¾åè¦æ±‚ä¸åŒï¼Ÿ

| äº¤æ˜“ç±»å‹ | ä¹‹å‰äº¤æ˜“çš„é”å®šæ¡ä»¶ | è§£é”æ‰€éœ€ç­¾å | åŸå›  |
|----------|-------------------|-------------|------|
| P2PKH | ä»˜æ¬¾ç»™å•ä¸ªå…¬é’¥å“ˆå¸Œ | 1ä¸ªç­¾å | èµ„é‡‘å½’å•äººæ‰€æœ‰ |
| 2-of-3å¤šç­¾ | éœ€è¦3ä¸ªå…¬é’¥ä¸­çš„2ä¸ª | 2ä¸ªç­¾å | èµ„é‡‘éœ€è¦å¤šæ–¹å…±åŒæ§åˆ¶ |
| 3-of-5å¤šç­¾ | éœ€è¦5ä¸ªå…¬é’¥ä¸­çš„3ä¸ª | 3ä¸ªç­¾å | æ›´é«˜çš„å®‰å…¨è¦æ±‚ |

> ğŸ’¡ **å…³é”®ç†è§£**ï¼šç­¾åè¦æ±‚ç”±**ä¹‹å‰äº¤æ˜“çš„è¾“å‡ºè„šæœ¬**å†³å®šï¼Œä¸æ˜¯ä»»æ„é€‰æ‹©çš„ï¼

### ğŸŒŸ å½¢è±¡åŒ–ç†è§£

æƒ³è±¡æ¯”ç‰¹å¸å°±åƒä¸€ä¸ªæ™ºèƒ½ä¿é™©ç®±ï¼š

**æ™®é€šä¿é™©ç®±ï¼ˆP2PKHï¼‰**ï¼š
```
ğŸ“¦ ä¹‹å‰æœ‰äººç»™Aliceå‘äº†ä¸€ä¸ªä¿é™©ç®±ï¼Œä¸Šé¢å†™ç€ï¼š"åªæœ‰Aliceçš„é’¥åŒ™èƒ½æ‰“å¼€"
ğŸ”‘ ç°åœ¨Aliceè¦ç”¨è¿™ä¸ªä¿é™©ç®±é‡Œçš„é’±ï¼Œåªéœ€è¦ç”¨å¥¹çš„é’¥åŒ™ï¼ˆç§é’¥ç­¾åï¼‰å³å¯
```

**å¤šé‡ç­¾åä¿é™©ç®±ï¼ˆMultiSigï¼‰**ï¼š
```
ğŸ“¦ ä¹‹å‰æœ‰äººç»™å…¬å¸å‘äº†ä¸€ä¸ªä¿é™©ç®±ï¼Œä¸Šé¢å†™ç€ï¼š"éœ€è¦CEOã€CFOã€CTOä¸­ä»»æ„2äººçš„é’¥åŒ™æ‰èƒ½æ‰“å¼€"
ğŸ”‘ğŸ”‘ ç°åœ¨å…¬å¸è¦ç”¨è¿™ä¸ªä¿é™©ç®±é‡Œçš„é’±ï¼Œå¿…é¡»æœ‰2ä¸ªäººåŒæ—¶ç”¨é’¥åŒ™ï¼ˆ2ä¸ªç§é’¥ç­¾åï¼‰
```

**é‡ç‚¹**ï¼šä¿é™©ç®±çš„å¼€é”è§„åˆ™æ˜¯**å‘é€è€…åœ¨åˆ›å»ºä¿é™©ç®±æ—¶å°±è®¾å®šå¥½çš„**ï¼Œæ¥æ”¶è€…å¿…é¡»æŒ‰ç…§è§„åˆ™æ¥è§£é”ï¼

### å¤šé‡ç­¾åäº¤æ˜“ç¤ºä¾‹

#### ä¾‹å­1ï¼šå¤šé‡ç­¾åäº¤æ˜“è¾“å…¥
```json
{
  "txid": "b2c3d4e5f6a7...ï¼ˆçœç•¥ï¼‰",
  "vout": 1,
  "scriptSig": {
    "asm": "OP_0 3045022100a1b2c3...ï¼ˆç­¾å1ï¼‰ 3044022067c8d9...ï¼ˆç­¾å2ï¼‰",
    "hex": "00483045022100a1b2c3...473044022067c8d9..."
  },
  "sequence": 4294967295
}
```

**åˆ†æ**ï¼š
- `OP_0`ï¼šå¤šé‡ç­¾åçš„ç‰¹æ®Šè¦æ±‚ï¼ˆBitcoinçš„ä¸€ä¸ªå·²çŸ¥bugï¼Œéœ€è¦é¢å¤–çš„0ï¼‰
- åŒ…å«ä¸¤ä¸ªæ•°å­—ç­¾åï¼Œæ»¡è¶³2-of-3å¤šç­¾è¦æ±‚
- è¿™ç¬”è¾“å…¥å¯¹åº”çš„ä¹‹å‰äº¤æ˜“è§„å®šäº†éœ€è¦3ä¸ªå…¬é’¥ä¸­çš„2ä¸ªç­¾å

#### ğŸ› æ·±å…¥ç†è§£ï¼šä¸ºä»€ä¹ˆå¤šç­¾éœ€è¦ OP_0ï¼Ÿ

è¿™æ˜¯æ¯”ç‰¹å¸å†å²ä¸Šä¸€ä¸ªè‘—åçš„æŠ€æœ¯å€ºåŠ¡ï¼è®©æˆ‘ä»¬æ·±å…¥äº†è§£è¿™ä¸ªæœ‰è¶£çš„æ•…äº‹ï¼š

**ğŸ“– å†å²èƒŒæ™¯**

å½“ä¸­æœ¬èªæœ€åˆå®ç°å¤šé‡ç­¾åéªŒè¯æ—¶ï¼ŒçŠ¯äº†ä¸€ä¸ªå°é”™è¯¯ï¼š

```javascript
// æ¯”ç‰¹å¸æºç ä¸­çš„å¤šç­¾éªŒè¯é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
bool CheckMultiSig() {
    // ... éªŒè¯ç­¾åé€»è¾‘ ...
    
    // ğŸ› è¿™é‡Œæœ‰ä¸ªbugï¼šä¼šå¤špopä¸€ä¸ªå…ƒç´ 
    stack.pop();  // æœ¬æ¥ä¸åº”è¯¥æœ‰è¿™ä¸€è¡Œ
    
    // éªŒè¯ç»“æœ
    return isValid;
}
```

**ğŸ” å…·ä½“é—®é¢˜**

æ­£å¸¸æƒ…å†µä¸‹ï¼Œ2-of-3 å¤šç­¾è„šæœ¬åº”è¯¥è¿™æ ·å·¥ä½œï¼š

```
å †æ ˆå†…å®¹ï¼ˆä»æ ˆé¡¶åˆ°æ ˆåº•ï¼‰ï¼š
[ç­¾å2] [ç­¾å1] [å…¬é’¥1] [å…¬é’¥2] [å…¬é’¥3] [2] [3] [OP_CHECKMULTISIG]
```

**ä½†æ˜¯**ï¼Œç”±äºä»£ç bugï¼Œ`OP_CHECKMULTISIG` ä¼šï¼š
1. æ­£ç¡®éªŒè¯ç­¾å
2. **å¤špopä¸€ä¸ªå…ƒç´ **ï¼ˆåƒæ‰ä¸€ä¸ªä¸è¯¥åƒçš„æ•°æ®ï¼‰

**ğŸ› ï¸ è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ  OP_0**

ä¸ºäº†è¡¥å¿è¿™ä¸ªå¤šå‡ºæ¥çš„popæ“ä½œï¼Œå¿…é¡»åœ¨å †æ ˆé¡¶éƒ¨æ”¾ä¸€ä¸ª"å«ç‰‡"ï¼š

```
å®é™…éœ€è¦çš„å †æ ˆï¼š
[OP_0] [ç­¾å2] [ç­¾å1] [å…¬é’¥1] [å…¬é’¥2] [å…¬é’¥3] [2] [3] [OP_CHECKMULTISIG]
 â†‘
 è¿™ä¸ªOP_0å°±æ˜¯"å«ç‰‡"ï¼Œä¼šè¢«bugå¤špopæ‰
```

**ğŸ’¡ ç±»æ¯”ç†è§£**

æƒ³è±¡ä¸€ä¸ªéªŒè¯èº«ä»½çš„æœºå™¨ï¼š

```
æ­£å¸¸è®¾è®¡ï¼š
è¾“å…¥ï¼š[èº«ä»½è¯] [é©¾ç…§] â†’ éªŒè¯ â†’ è¿”è¿˜è¯ä»¶

å®é™…æƒ…å†µï¼ˆæœ‰bugï¼‰ï¼š
è¾“å…¥ï¼š[ç©ºçº¸ç‰‡] [èº«ä»½è¯] [é©¾ç…§] â†’ éªŒè¯ â†’ åƒæ‰ç©ºçº¸ç‰‡ï¼Œè¿”è¿˜è¯ä»¶
                â†‘
              å¿…é¡»æ”¾è¿™ä¸ª"å«ç‰‡"
```

**ğŸ¤” ä¸ºä»€ä¹ˆä¸ä¿®å¤è¿™ä¸ªbugï¼Ÿ**

1. **å‘åå…¼å®¹æ€§**ï¼šä¿®å¤ä¼šå¯¼è‡´æ‰€æœ‰å†å²å¤šç­¾äº¤æ˜“å¤±æ•ˆ
2. **å…±è¯†è§„åˆ™**ï¼šæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä¿æŒç›¸åŒçš„éªŒè¯é€»è¾‘  
3. **å†å²æˆæœ¬**ï¼šä¿®å¤çš„é£é™©è¿œå¤§äºæ”¶ç›Š

> ğŸ’­ **æœ‰è¶£çš„äº‹å®**ï¼šè¿™ä¸ª OP_0 è‡³ä»Šä»å­˜åœ¨äºæ¯ä¸€ç¬”å¤šé‡ç­¾åäº¤æ˜“ä¸­ï¼Œæˆä¸ºæ¯”ç‰¹å¸å†å²çš„æ°¸ä¹…å°è®°ï¼

### P2SHè¾“å‡ºï¼ˆæ”¯æŒå¤æ‚è„šæœ¬ï¼‰
```json
{
  "value": 0.05000000,
  "n": 1,
  "scriptPubKey": {
    "asm": "OP_HASH160 1234567890abcdef...ï¼ˆ20å­—èŠ‚è„šæœ¬å“ˆå¸Œï¼‰ OP_EQUAL",
    "hex": "a9141234567890abcdef...87",
    "type": "scripthash",
    "address": "3AnNyxwqnDUP7r3jKFaLWcqwYBdXjTPoBe"
  }
}
```

**åˆ†æ**ï¼š
- åœ°å€ä»¥`3`å¼€å¤´çš„P2SHåœ°å€
- å¯ä»¥åŒ…å«å¤šé‡ç­¾åã€æ—¶é—´é”ç­‰å¤æ‚æ¡ä»¶
- è„šæœ¬å“ˆå¸Œéšè—äº†çœŸå®çš„å¤æ‚è„šæœ¬ï¼Œæé«˜éšç§æ€§

## éš”ç¦»è§è¯(SegWit)æŠ€æœ¯

### SegWit æ˜¯ä»€ä¹ˆï¼Ÿ

éš”ç¦»è§è¯æ˜¯æ¯”ç‰¹å¸å†å²ä¸Šæœ€é‡è¦çš„å‡çº§ä¹‹ä¸€ï¼è®©æˆ‘ä»¬ç”¨ç®€å•æ˜“æ‡‚çš„æ–¹å¼æ¥ç†è§£å®ƒï¼š

#### ğŸ“‹ ä»€ä¹ˆæ˜¯"è§è¯"ï¼ˆWitnessï¼‰ï¼Ÿ

åœ¨æ¯”ç‰¹å¸äº¤æ˜“ä¸­ï¼Œ"è§è¯"å°±æ˜¯**è¯æ˜ä½ æœ‰æƒèŠ±è´¹æ¯”ç‰¹å¸çš„æ•°æ®**ï¼Œä¸»è¦åŒ…æ‹¬ï¼š
- æ•°å­—ç­¾å
- å…¬é’¥
- å…¶ä»–éªŒè¯è„šæœ¬

#### ğŸ”„ SegWitå‰åå¯¹æ¯”

**ä¼ ç»Ÿäº¤æ˜“ç»“æ„**ï¼š
```
äº¤æ˜“ = {
  è¾“å…¥: [
    {
      txid: "ä¸Šä¸€ç¬”äº¤æ˜“ID",
      vout: è¾“å‡ºç´¢å¼•,
      scriptSig: "ç­¾å + å…¬é’¥ + å…¶ä»–è¯æ˜æ•°æ®",  â† è§è¯æ•°æ®åœ¨è¿™é‡Œ
      sequence: åºåˆ—å·
    }
  ],
  è¾“å‡º: [...],
  å…¶ä»–å…ƒæ•°æ®: {...}
}
```

**SegWitäº¤æ˜“ç»“æ„**ï¼š
```
äº¤æ˜“ = {
  è¾“å…¥: [
    {
      txid: "ä¸Šä¸€ç¬”äº¤æ˜“ID", 
      vout: è¾“å‡ºç´¢å¼•,
      scriptSig: "ç®€åŒ–çš„å¼•ç”¨ä¿¡æ¯",           â† å¤§å¤§ç¼©å°äº†
      sequence: åºåˆ—å·
    }
  ],
  è¾“å‡º: [...],
  å…¶ä»–å…ƒæ•°æ®: {...},
  witness: [                                  â† è§è¯æ•°æ®è¢«"éš”ç¦»"åˆ°è¿™é‡Œ
    ["ç­¾å", "å…¬é’¥", "å…¶ä»–è¯æ˜æ•°æ®"]
  ]
}
```

#### SegWitäº¤æ˜“ç¤ºä¾‹

```json
{
  "txid": "c3d4e5f6a7b8...ï¼ˆçœç•¥ï¼‰",
  "vout": 0,
  "scriptSig": {
    "asm": "OP_PUSHBYTES_22 0014a1b2c3d4e5f6...",
    "hex": "160014a1b2c3d4e5f6..."
  },
  "witness": [
    "3045022100d1e2f3a4b5c6...ï¼ˆç­¾åï¼‰",
    "0279be667ef9dcbb...ï¼ˆå…¬é’¥ï¼‰"
  ],
  "sequence": 4294967293
}
```

**åˆ†æ**ï¼š
- `scriptSig`åªåŒ…å«SegWitç¨‹åºçš„å¼•ç”¨ï¼ˆæ›´èŠ‚çœç©ºé—´ï¼‰
- çœŸæ­£çš„ç­¾åå’Œå…¬é’¥åœ¨`witness`å­—æ®µä¸­ï¼ˆéš”ç¦»è§è¯ï¼‰
- `sequence`å€¼`4294967293`è¡¨ç¤ºæ”¯æŒRBFï¼ˆäº¤æ˜“æ›¿æ¢ï¼‰
- è¿™ç§æ ¼å¼å¯ä»¥é™ä½äº¤æ˜“è´¹ç”¨

### ğŸ¯ "éš”ç¦»"çš„æ ¸å¿ƒæ€æƒ³

âš ï¸ **é‡è¦æ¾„æ¸…**ï¼šwitnessæ•°æ®ä¾ç„¶å®Œå…¨å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šï¼

æƒ³è±¡ä¸€ä¸ªåŒ…è£¹ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼š
ğŸ“¦ [å•†å“ + å‘ç¥¨ + ç­¾åæ”¶æ® + èº«ä»½è¯æ˜] 
   â†‘ æ‰€æœ‰ä¸œè¥¿æ··åœ¨ä¸€èµ·ï¼ŒåŒ…è£¹å¾ˆé‡

SegWitæ–¹å¼ï¼š
ğŸ“¦ [å•†å“ + å‘ç¥¨] + ğŸ“‹ [ç­¾åæ”¶æ® + èº«ä»½è¯æ˜]
   â†‘ ä¸»ä½“åŒ…è£¹     â†‘ å•ç‹¬çš„è¯æ˜æ–‡ä»¶
   å¾ˆè½»            å¯é€‰æºå¸¦

ğŸ“® ä½†æ˜¯ï¼ä¸¤ä¸ªåŒ…è£¹éƒ½ä¼šä¸€èµ·é‚®å¯„ï¼æ²¡æœ‰ä»»ä½•ä¸œè¥¿ä¸¢å¤±ï¼
```

### ğŸ”§ æŠ€æœ¯ä¼˜åŠ¿è¯¦è§£

#### 1. è§£å†³äº¤æ˜“å»¶å±•æ€§ï¼ˆTransaction Malleabilityï¼‰

```
ä¼ ç»Ÿäº¤æ˜“IDè®¡ç®—ï¼š
txid = hash(æ•´ä¸ªäº¤æ˜“æ•°æ®ï¼ŒåŒ…æ‹¬ç­¾å)

é—®é¢˜ï¼šç­¾åå¯ä»¥è¢«ç¬¬ä¸‰æ–¹ä¿®æ”¹ï¼ˆä¸å½±å“æœ‰æ•ˆæ€§ï¼Œä½†æ”¹å˜txidï¼‰

SegWitäº¤æ˜“IDè®¡ç®—ï¼š
txid = hash(äº¤æ˜“æ•°æ®ï¼Œä¸åŒ…æ‹¬witness)  â† ç­¾åè¢«æ’é™¤åœ¨å¤–

ç»“æœï¼štxidå˜å¾—ç¨³å®šï¼Œæ— æ³•è¢«æ¶æ„ä¿®æ”¹
```

#### 2. å¢åŠ åŒºå—å®¹é‡

**ğŸš¨ æ ¸å¿ƒå˜åŒ–ï¼šä¸å†æŒ‰"å¤§å°"é™åˆ¶ï¼Œæ”¹ä¸ºæŒ‰"æƒé‡"é™åˆ¶**

```
Bitcoinå‡çº§å‰çš„è§„åˆ™ï¼š
åŒºå—æœ€å¤§é™åˆ¶ = 1,000,000 å­—èŠ‚

Bitcoinå‡çº§åçš„è§„åˆ™ï¼š  
åŒºå—æœ€å¤§é™åˆ¶ = 4,000,000 æƒé‡å•ä½  â† è§„åˆ™æ”¹äº†ï¼

æƒé‡è®¡ç®—å…¬å¼ï¼š
æƒé‡ = (åŸºç¡€äº¤æ˜“æ•°æ® Ã— 4) + (witnessæ•°æ® Ã— 1)
```

#### 3. é™ä½äº¤æ˜“è´¹ç”¨

```
è´¹ç”¨è®¡ç®—æ–¹å¼æ”¹å˜ï¼š

ä¼ ç»Ÿï¼š
è´¹ç”¨ = å­—èŠ‚æ•° Ã— è´¹ç‡

SegWitï¼š
è´¹ç”¨ = æƒé‡å•ä½ Ã— è´¹ç‡
æƒé‡ = åŸºç¡€æ•°æ®Ã—4 + witnessæ•°æ®Ã—1  â† witnessæ•°æ®æ›´ä¾¿å®œ
```

### ğŸ“Š å…·ä½“è®¡ç®—ä¾‹å­

å‡è®¾ä¸€ç¬”ç®€å•çš„è½¬è´¦äº¤æ˜“ï¼š

```
ä¼ ç»Ÿäº¤æ˜“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸºç¡€æ•°æ®ï¼š118å­—èŠ‚              â”‚
â”‚  ç­¾åæ•°æ®ï¼š107å­—èŠ‚              â”‚
â”‚  æ€»å¤§å°ï¼š225å­—èŠ‚                â”‚
â”‚  å ç”¨ç©ºé—´ï¼š225å­—èŠ‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SegWitäº¤æ˜“ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸºç¡€æ•°æ®ï¼š118å­—èŠ‚              â”‚  â† æƒé‡ï¼š118 Ã— 4 = 472
â”‚  witnessæ•°æ®ï¼š107å­—èŠ‚           â”‚  â† æƒé‡ï¼š107 Ã— 1 = 107  
â”‚  æ€»å¤§å°ï¼š225å­—èŠ‚ï¼ˆæ²¡å˜ï¼ï¼‰      â”‚
â”‚  æ€»æƒé‡ï¼š472 + 107 = 579å•ä½    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ” åŒºå—å®¹é‡çš„"é­”æ³•"

```
ä¼ ç»ŸåŒºå—ï¼ˆ1MBé™åˆ¶ï¼‰ï¼š
èƒ½è£…äº¤æ˜“æ•° = 1,000,000å­—èŠ‚ Ã· 225å­—èŠ‚/äº¤æ˜“ â‰ˆ 4,444ç¬”äº¤æ˜“

SegWitåŒºå—ï¼ˆ4Mæƒé‡é™åˆ¶ï¼‰ï¼š
èƒ½è£…äº¤æ˜“æ•° = 4,000,000æƒé‡ Ã· 579æƒé‡/äº¤æ˜“ â‰ˆ 6,907ç¬”äº¤æ˜“

æå‡ = 6,907 Ã· 4,444 â‰ˆ 55%çš„å®¹é‡å¢é•¿ï¼
```

### âš ï¸ å…¼å®¹æ€§è€ƒè™‘

```
å‘åå…¼å®¹ï¼š
âœ… è€èŠ‚ç‚¹å¯ä»¥éªŒè¯SegWitäº¤æ˜“ï¼ˆä½œä¸º"ä»»ä½•äººå¯èŠ±è´¹"ï¼‰
âœ… SegWitèŠ‚ç‚¹å¯ä»¥éªŒè¯ä¼ ç»Ÿäº¤æ˜“
âœ… æ··åˆä½¿ç”¨æ²¡é—®é¢˜

å‡çº§ç­–ç•¥ï¼š
è½¯åˆ†å‰ â†’ ä¸å¼ºåˆ¶å‡çº§ï¼Œæ¸è¿›é‡‡ç”¨
```

## Taprootå‡çº§è¯¦è§£

Taproot æ˜¯æ¯”ç‰¹å¸åœ¨ SegWit ä¹‹åçš„åˆä¸€æ¬¡é‡è¦å‡çº§ï¼è®©æˆ‘ä»¬è¯¦ç»†äº†è§£ï¼š

### ğŸ“… åŸºæœ¬ä¿¡æ¯
```
æ¿€æ´»æ—¶é—´ï¼š2021å¹´11æœˆ14æ—¥ï¼ˆåŒºå—709,632ï¼‰
å‡çº§æ–¹å¼ï¼šè½¯åˆ†å‰ï¼ˆSpeedy Trialï¼‰
æ ¸å¿ƒæŠ€æœ¯ï¼šSchnorrç­¾å + MAST + Tapscript
ä¸»è¦ç›®æ ‡ï¼šéšç§æ€§ + æ•ˆç‡ + æ™ºèƒ½åˆçº¦åŠŸèƒ½å¢å¼º
```

### ğŸ”‘ æ ¸å¿ƒæŠ€æœ¯åˆ›æ–°

#### 1. Schnorr ç­¾åç®—æ³•
```
ä¼ ç»Ÿ ECDSA vs æ–° Schnorrï¼š

ECDSAï¼ˆä¼ ç»Ÿï¼‰ï¼š
- ç­¾åé•¿åº¦ï¼š71-73å­—èŠ‚
- å¤šç­¾å¤æ‚ï¼šéœ€è¦å¤šä¸ªç­¾å
- éšç§æ€§å·®ï¼šå®¹æ˜“è¯†åˆ«å¤šç­¾äº¤æ˜“

Schnorrï¼ˆTaprootï¼‰ï¼š
- ç­¾åé•¿åº¦ï¼š64å­—èŠ‚ï¼ˆå›ºå®šï¼‰
- ç­¾åèšåˆï¼šå¤šä¸ªç­¾åâ†’ä¸€ä¸ªç­¾å
- éšç§å¢å¼ºï¼šå¤šç­¾çœ‹èµ·æ¥åƒå•ç­¾
```

#### 2. MASTï¼ˆMerklized Abstract Syntax Treesï¼‰
```
é—®é¢˜ï¼šå¤æ‚è„šæœ¬æš´éœ²æ‰€æœ‰æ¡ä»¶
è§£å†³ï¼šåªæš´éœ²ä½¿ç”¨çš„æ‰§è¡Œè·¯å¾„

ä¼ ç»ŸP2SHè„šæœ¬ï¼š
IF 
  Aliceç­¾å AND Bobç­¾å    # æ¡ä»¶1
ELSE
  æ—¶é—´é” AND Charlieç­¾å   # æ¡ä»¶2  
ENDIF

MASTè„šæœ¬ï¼š
é»˜è®¤ï¼šAliceå•ç­¾ï¼ˆæœ€å¸¸ç”¨ï¼‰
å¤‡é€‰ï¼šMerkleæ ‘æ ¹ï¼ˆåŒ…å«å…¶ä»–å¤æ‚æ¡ä»¶ï¼‰
â†’ åªæœ‰å®é™…ä½¿ç”¨çš„æ¡ä»¶æ‰ä¼šä¸Šé“¾
```

### ğŸ¯ Taproot äº¤æ˜“ç»“æ„

```json
// Taprootäº¤æ˜“ç¤ºä¾‹
{
  "vin": [
    {
      "txid": "abc123...",
      "vout": 0,
      "scriptSig": {
        "asm": "",
        "hex": ""
      },
      "witness": [
        "signature_64_bytes"  // â† ç®€æ´çš„Schnorrç­¾å
      ]
    }
  ],
  "vout": [
    {
      "value": 0.01000000,
      "scriptPubKey": {
        "asm": "OP_1 5d7rjc4k3m8n9p0q1r2s3t4u5v6w7x8y9z",
        "type": "witness_v1_taproot",       // â† Taprootç±»å‹
        "address": "bc1p5d7rjc4k3m8n..."   // â† bc1på¼€å¤´
      }
    }
  ]
}
```

### ğŸ”’ éšç§æ€§æå‡

```
éšç§å¯¹æ¯”ï¼š

ä¼ ç»Ÿå¤šç­¾ (2-of-3)ï¼š
åœ°å€ï¼š3AnNyxwq...ï¼ˆP2SHï¼‰
â†’ ä¸€çœ‹å°±çŸ¥é“æ˜¯å¤šç­¾
â†’ è„šæœ¬æš´éœ²æ‰€æœ‰æ¡ä»¶

Taprootå¤šç­¾ï¼š
åœ°å€ï¼šbc1p5d7rj...ï¼ˆP2TRï¼‰
â†’ çœ‹èµ·æ¥åƒæ™®é€šå•ç­¾ âœ¨
â†’ åªæœ‰èŠ±è´¹æ—¶æ‰çŸ¥é“æ˜¯å¦å¤æ‚

å¥½å¤„ï¼š
âœ… äº¤æ˜“éšç§æ€§å¤§å¢
âœ… é“¾ä¸Šåˆ†ææ›´å›°éš¾
âœ… ç”¨æˆ·éšç§ä¿æŠ¤
```

### âš¡ æ•ˆç‡æå‡

```
æ•°æ®å¤§å°å¯¹æ¯”ï¼š

ä¼ ç»Ÿ2-of-3å¤šç­¾ï¼š
- è„šæœ¬å¤§å°ï¼š~105å­—èŠ‚
- ç­¾åæ•°æ®ï¼š~144å­—èŠ‚ï¼ˆ2ä¸ªç­¾åï¼‰
- æ€»å¼€é”€ï¼š~249å­—èŠ‚

Taprootå¤šç­¾ï¼ˆèšåˆç­¾åï¼‰ï¼š
- è„šæœ¬å¤§å°ï¼š32å­—èŠ‚ï¼ˆåªæœ‰å…¬é’¥å“ˆå¸Œï¼‰
- ç­¾åæ•°æ®ï¼š64å­—èŠ‚ï¼ˆèšåˆåçš„å•ç­¾åï¼‰
- æ€»å¼€é”€ï¼š~96å­—èŠ‚

èŠ‚çœï¼š(249-96)/249 â‰ˆ 61%çš„ç©ºé—´ï¼
```

### ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯

```
Taprootç‰¹åˆ«é€‚åˆï¼š

1. ä¼ä¸šå¤šç­¾é’±åŒ…ï¼š
   çœ‹èµ·æ¥åƒä¸ªäººé’±åŒ…ï¼Œä¿æŠ¤å•†ä¸šéšç§

2. å¤æ‚ç»§æ‰¿æ–¹æ¡ˆï¼š
   "æˆ‘å•ç­¾ OR (æ—¶é—´é” AND ç»§æ‰¿äººç­¾å)"
   æ—¥å¸¸ä½¿ç”¨åªæš´éœ²å•ç­¾éƒ¨åˆ†

3. é—ªç”µç½‘ç»œï¼š
   é€šé“å…³é—­çœ‹èµ·æ¥åƒæ™®é€šè½¬è´¦
   å¢å¼ºéšç§æ€§

4. DeFi åº”ç”¨ï¼š
   å¤æ‚çš„DeFié€»è¾‘åœ¨é“¾ä¸Šç®€åŒ–æ˜¾ç¤º
```

## å¤æ‚äº¤æ˜“ç±»å‹åˆ†æ

### OP_RETURNè¾“å‡ºï¼ˆè‡ªå®šä¹‰æ•°æ®å­˜å‚¨ï¼‰

**é‡è¦è¯´æ˜**ï¼šOP_RETURN æ˜¯äº¤æ˜“**è¾“å‡ºï¼ˆOutputsï¼‰**çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼

```json
{
  "value": 0.00000000,
  "n": 3,
  "scriptPubKey": {
    "asm": "OP_RETURN 48656c6c6f20426974636f696e",
    "hex": "6a0d48656c6c6f20426974636f696e",
    "type": "nulldata"
  }
}
```

**åˆ†æ**ï¼š
- **è¿™å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„äº¤æ˜“è¾“å‡º**ï¼Œå’ŒP2PKHè¾“å‡ºç»“æ„å®Œå…¨ä¸€æ ·
- `value`: 0 BTCï¼ˆæ— ä»·å€¼è½¬ç§»ï¼Œä¸“é—¨ç”¨äºæ•°æ®å­˜å‚¨ï¼‰
- `n`: 3ï¼ˆè¿™æ˜¯äº¤æ˜“çš„ç¬¬4ä¸ªè¾“å‡ºï¼Œç´¢å¼•ä»0å¼€å§‹ï¼‰
- **scriptPubKey**ï¼šé”å®šè„šæœ¬ï¼Œè¿™é‡Œæ˜¯OP_RETURNç±»å‹
- `48656c6c6f20426974636f696e`è§£ç åæ˜¯"Hello Bitcoin"
- è¿™ç§è¾“å‡º**æ— æ³•è¢«èŠ±è´¹**ï¼Œæ•°æ®æ°¸ä¹…ä¿å­˜åœ¨åŒºå—é“¾ä¸Š

### ğŸ“Š æ¯”ç‰¹å¸äº¤æ˜“ç»“æ„æ€»è§ˆ

```
æ¯”ç‰¹å¸äº¤æ˜“ = {
  äº¤æ˜“å…ƒæ•°æ®: {
    version: äº¤æ˜“ç‰ˆæœ¬
    locktime: é”å®šæ—¶é—´
  }
  
  è¾“å…¥æ•°ç»„: [
    { txid, vout, scriptSig, sequence },
    { txid, vout, scriptSig, sequence },
    ...
  ]
  
  è¾“å‡ºæ•°ç»„: [                    â† OP_RETURNåœ¨è¿™é‡Œï¼
    { value, scriptPubKey },     â† æ™®é€šP2PKHè¾“å‡º
    { value, scriptPubKey },     â† å¤šç­¾P2SHè¾“å‡º
    { value, scriptPubKey },     â† OP_RETURNè¾“å‡ºï¼ˆå­˜å‚¨æ•°æ®ï¼‰
    ...
  ]
}
```

> ğŸ’¡ **è¿™å°±æ˜¯è‡ªå®šä¹‰æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼**
> 
> **å¸¸è§ç”¨é€”**ï¼š
> - ğŸ“ **ç•™è¨€**ï¼šåœ¨è½¬è´¦æ—¶é™„ä¸Šæ–‡å­—ä¿¡æ¯
> - ğŸ·ï¸ **æ ‡è®°**ï¼šè®°å½•äº¤æ˜“ç”¨é€”æˆ–åˆ†ç±»
> - ğŸ“„ **æ–‡æ¡£å“ˆå¸Œ**ï¼šå­˜å‚¨æ–‡ä»¶çš„å“ˆå¸Œå€¼ä½œä¸ºå­˜åœ¨æ€§è¯æ˜
> - ğŸ¨ **è‰ºæœ¯åˆ›ä½œ**ï¼šä¸€äº›æ—©æœŸçš„åŒºå—é“¾è‰ºæœ¯é¡¹ç›®
> 
> **é™åˆ¶**ï¼š
> - æœ€å¤šå­˜å‚¨ **80å­—èŠ‚** çš„æ•°æ®
> - éœ€è¦æ”¯ä»˜å°‘é‡æ‰‹ç»­è´¹
> - æ•°æ®ä¸€æ—¦ä¸Šé“¾å°±æ— æ³•ä¿®æ”¹æˆ–åˆ é™¤

#### ğŸ” å®é™…æ¡ˆä¾‹åˆ†æ

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªçœŸå®çš„OP_RETURNäº¤æ˜“ï¼š

```
äº¤æ˜“ID: 4b72a223b2d45ea382...
OP_RETURNæ•°æ®: "åŒºå—é“¾æ°¸è¿œè®°ä½è¿™ä¸€åˆ»ï¼2024å¹´æ–°å¹´å¿«ä¹ï¼"
```

è¿™ç¬”äº¤æ˜“çš„å‘é€è€…èŠ±è´¹äº†å°‘é‡æ‰‹ç»­è´¹ï¼Œåœ¨æ¯”ç‰¹å¸åŒºå—é“¾ä¸Šæ°¸ä¹…è®°å½•äº†è¿™æ¡æ–°å¹´ç¥ç¦ã€‚ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡åŒºå—æµè§ˆå™¨æŸ¥çœ‹è¿™æ¡ä¿¡æ¯ï¼Œå®ƒå°†æ°¸è¿œå­˜åœ¨äºåŒºå—é“¾ä¸Šã€‚

## åœ°å€æ ¼å¼æ¼”è¿›

### æ¯”ç‰¹å¸åœ°å€æ ¼å¼å‘å±•å†ç¨‹

| æ ¼å¼ | åœ°å€ç¤ºä¾‹ | è„šæœ¬ç±»å‹ | ç‰¹ç‚¹ |
|------|----------|----------|------|
| Legacy (P2PKH) | 1BoatSLRH... | P2PKH | æœ€åŸå§‹æ ¼å¼ï¼Œå…¼å®¹æ€§æœ€å¥½ |
| Script (P2SH) | 3AnNyxwq... | P2SH | æ”¯æŒå¤šç­¾åç­‰å¤æ‚åŠŸèƒ½ |
| SegWit (Bech32) | bc1q40x77y... | P2WPKH | æ‰‹ç»­è´¹æœ€ä½ï¼Œæœ€é«˜æ•ˆ |
| Taproot (Bech32m) | bc1p5d7rj... | P2TR | æœ€æ–°æ ¼å¼ï¼Œéšç§æ€§æ›´å¥½ |

### ğŸ”— æŠ€æœ¯æ¼”è¿›å¯¹æ¯”

```
æ¯”ç‰¹å¸åœ°å€æ ¼å¼æ¼”è¿›ï¼š

Legacy (2009)ï¼š
åœ°å€ï¼š1abc...
ç‰¹ç‚¹ï¼šåŸºç¡€åŠŸèƒ½ï¼Œå¤§å°è¾ƒå¤§

P2SH (2012)ï¼š
åœ°å€ï¼š3abc...  
ç‰¹ç‚¹ï¼šæ”¯æŒå¤šç­¾ï¼Œä½†éšç§æ€§å·®

SegWit (2017)ï¼š
åœ°å€ï¼šbc1qabc...
ç‰¹ç‚¹ï¼šé™ä½è´¹ç”¨ï¼Œè§£å†³å»¶å±•æ€§

Taproot (2021)ï¼š
åœ°å€ï¼šbc1pabc...
ç‰¹ç‚¹ï¼šæœ€ä½³éšç§ + æ•ˆç‡ + æ™ºèƒ½åˆçº¦
```

### ğŸ“Š é‡‡ç”¨æƒ…å†µ

```
Taprooté‡‡ç”¨ç‡ï¼š

2021å¹´11æœˆï¼ˆæ¿€æ´»ï¼‰ï¼š0%
2022å¹´ï¼š5-10%
2023å¹´ï¼š15-25%
2024å¹´ï¼š30-40%

å¢é•¿å› ç´ ï¼š
âœ… é’±åŒ…æ”¯æŒå¢åŠ 
âœ… äº¤æ˜“æ‰€é‡‡ç”¨
âœ… BRC-20ä½¿ç”¨Taprootï¼ˆOrdinalsï¼‰
âš ï¸ ä»åœ¨æ¸è¿›é‡‡ç”¨ä¸­
```

## é«˜çº§äº¤æ˜“åº”ç”¨

### 1. æ—¶é—´é”å®šäº¤æ˜“

æ¯”ç‰¹å¸æ”¯æŒåŸºäºæ—¶é—´çš„äº¤æ˜“é”å®šï¼š

#### ç»å¯¹æ—¶é—´é”ï¼ˆLocktimeï¼‰
```json
{
  "locktime": 700000,  // åŒºå—é«˜åº¦æˆ–æ—¶é—´æˆ³
  // ... å…¶ä»–äº¤æ˜“æ•°æ®
}
```

#### ç›¸å¯¹æ—¶é—´é”ï¼ˆCheckSequenceVerifyï¼‰
```
OP_PUSHDATA 144    // ç›¸å¯¹é”å®š144ä¸ªåŒºå—ï¼ˆçº¦24å°æ—¶ï¼‰
OP_CHECKSEQUENCEVERIFY
```

### 2. å“ˆå¸Œæ—¶é—´é”åˆçº¦ï¼ˆHTLCï¼‰

é—ªç”µç½‘ç»œçš„åŸºç¡€ç»„ä»¶ï¼š

```
OP_IF
    OP_HASH160 <hash> OP_EQUALVERIFY
    <pubkey> OP_CHECKSIG
OP_ELSE
    <timeout> OP_CHECKLOCKTIMEVERIFY OP_DROP
    <pubkey> OP_CHECKSIG
OP_ENDIF
```

### 3. åŸå­äº¤æ¢

è·¨é“¾äº¤æ˜“çš„æ ¸å¿ƒæŠ€æœ¯ï¼š

```
Aliceçš„æ¯”ç‰¹å¸é”å®šè„šæœ¬ï¼š
- æä¾›secretçš„preimage + Bobçš„ç­¾å
- æˆ–è€…è¶…æ—¶åAliceå¯ä»¥æ”¶å›

Bobçš„è±ç‰¹å¸é”å®šè„šæœ¬ï¼š
- æä¾›ç›¸åŒsecretçš„preimage + Aliceçš„ç­¾å  
- æˆ–è€…è¶…æ—¶åBobå¯ä»¥æ”¶å›
```

## å®æˆ˜æ¼”ç»ƒï¼šé«˜çº§äº¤æ˜“

### åˆ›å»ºå¤šé‡ç­¾ååœ°å€

```python
import requests
import json

def bitcoin_rpc(method, params=[]):
    url = "http://localhost:8332"
    headers = {'content-type': 'application/json'}
    
    payload = {
        "method": method,
        "params": params,
        "jsonrpc": "2.0",
        "id": 0,
    }
    
    response = requests.post(url, data=json.dumps(payload), headers=headers, auth=('user', 'password'))
    return response.json()

def create_multisig_address():
    # 1. ç”Ÿæˆå…¬é’¥ï¼ˆç¤ºä¾‹ï¼‰
    pubkeys = [
        "03a1b2c3d4e5f6...",  # å…¬é’¥1
        "03b1c2d3e4f5a6...",  # å…¬é’¥2
        "03c1d2e3f4a5b6..."   # å…¬é’¥3
    ]
    
    # 2. åˆ›å»º2-of-3å¤šç­¾åœ°å€
    result = bitcoin_rpc("createmultisig", [2, pubkeys])
    
    print(f"å¤šç­¾åœ°å€: {result['result']['address']}")
    print(f"èµå›è„šæœ¬: {result['result']['redeemScript']}")
    
    return result['result']

# æ‰§è¡Œåˆ›å»ºå¤šç­¾åœ°å€
multisig_info = create_multisig_address()
```

### åˆ›å»ºSegWitäº¤æ˜“

```python
def create_segwit_transaction():
    # 1. é€‰æ‹©SegWit UTXO
    inputs = [
        {
            "txid": "your_segwit_utxo_txid",
            "vout": 0
        }
    ]
    
    # 2. åˆ›å»ºSegWitè¾“å‡º
    outputs = {
        "bc1qsegwit_address_here": 0.001,  # SegWitåœ°å€
        "bc1qchange_address": 0.0089       # æ‰¾é›¶
    }
    
    # 3. åˆ›å»ºåŸå§‹äº¤æ˜“
    raw_tx = bitcoin_rpc("createrawtransaction", [inputs, outputs])
    
    # 4. ç­¾åï¼ˆSegWitä¼šè‡ªåŠ¨å¤„ç†witnessæ•°æ®ï¼‰
    signed_tx = bitcoin_rpc("signrawtransactionwithwallet", [raw_tx['result']])
    
    # 5. å¹¿æ’­
    if signed_tx['result']['complete']:
        txid = bitcoin_rpc("sendrawtransaction", [signed_tx['result']['hex']])
        print(f"SegWitäº¤æ˜“å·²å‘é€ï¼š{txid['result']}")
    
    return txid['result']
```

### ç›‘æ§å¤æ‚äº¤æ˜“

```python
def analyze_transaction(txid):
    """åˆ†æäº¤æ˜“ç±»å‹å’Œç‰¹å¾"""
    
    # è·å–äº¤æ˜“è¯¦æƒ…
    tx = bitcoin_rpc("gettransaction", [txid])
    decoded = bitcoin_rpc("decoderawtransaction", [tx['result']['hex']])
    
    analysis = {
        'txid': txid,
        'size': len(tx['result']['hex']) // 2,
        'input_count': len(decoded['result']['vin']),
        'output_count': len(decoded['result']['vout']),
        'types': []
    }
    
    # åˆ†æè¾“å…¥ç±»å‹
    for inp in decoded['result']['vin']:
        if 'witness' in inp and inp['witness']:
            if len(inp['witness']) == 2:
                analysis['types'].append('P2WPKH')
            else:
                analysis['types'].append('Complex SegWit')
        elif inp['scriptSig']['hex']:
            analysis['types'].append('Legacy')
    
    # åˆ†æè¾“å‡ºç±»å‹
    for out in decoded['result']['vout']:
        script_type = out['scriptPubKey']['type']
        if script_type == 'pubkeyhash':
            analysis['types'].append('P2PKH')
        elif script_type == 'scripthash':
            analysis['types'].append('P2SH')
        elif script_type == 'witness_v0_keyhash':
            analysis['types'].append('P2WPKH')
        elif script_type == 'witness_v1_taproot':
            analysis['types'].append('Taproot')
        elif script_type == 'nulldata':
            analysis['types'].append('OP_RETURN')
    
    return analysis

# åˆ†æäº¤æ˜“
result = analyze_transaction("your_transaction_id")
print(f"äº¤æ˜“åˆ†æï¼š{result}")
```

## å¸¸è§é—®é¢˜

### â“ SegWitäº¤æ˜“çš„è´¹ç”¨çœŸçš„æ›´ä¾¿å®œå—ï¼Ÿ

æ˜¯çš„ï¼å› ä¸ºwitnessæ•°æ®åœ¨æƒé‡è®¡ç®—ä¸­äº«å—75%æŠ˜æ‰£ï¼š

```
ä¼ ç»ŸP2PKHäº¤æ˜“ï¼š225å­—èŠ‚ Ã— è´¹ç‡
SegWit P2WPKHäº¤æ˜“ï¼š579æƒé‡å•ä½ Ã— è´¹ç‡

ç”±äº579 < 225Ã—4 = 900ï¼Œæ‰€ä»¥SegWitæ›´ä¾¿å®œ
```

### â“ Taprootåœ°å€ä¸ºä»€ä¹ˆè¿˜æ²¡æœ‰æ™®åŠï¼Ÿ

ä¸»è¦åŸå› ï¼š
1. **é’±åŒ…æ”¯æŒç¼“æ…¢**ï¼šéœ€è¦é’±åŒ…è½¯ä»¶å‡çº§
2. **ç”¨æˆ·æ•™è‚²ä¸è¶³**ï¼šç”¨æˆ·ä¸äº†è§£Taprootä¼˜åŠ¿
3. **ç½‘ç»œæ•ˆåº”**ï¼šéœ€è¦ç”Ÿæ€ç³»ç»Ÿæ•´ä½“é‡‡ç”¨
4. **å…¼å®¹æ€§è€ƒè™‘**ï¼šä¸€äº›æœåŠ¡è¿˜ä¸æ”¯æŒbc1påœ°å€

### â“ å¦‚ä½•é€‰æ‹©åˆé€‚çš„äº¤æ˜“ç±»å‹ï¼Ÿ

| éœ€æ±‚ | æ¨èç±»å‹ | åŸå›  |
|------|----------|------|
| ä¸ªäººè½¬è´¦ | P2WPKH (SegWit) | è´¹ç”¨ä½ï¼Œæ•ˆç‡é«˜ |
| ä¼ä¸šå¤šç­¾ | P2WSH (SegWitå¤šç­¾) | å®‰å…¨æ€§+è´¹ç”¨ä¼˜åŒ– |
| æœ€å¤§éšç§ | P2TR (Taproot) | éšç§ä¿æŠ¤æœ€ä½³ |
| æœ€å¤§å…¼å®¹ | P2PKH (Legacy) | æ‰€æœ‰é’±åŒ…éƒ½æ”¯æŒ |
| æ•°æ®å­˜å‚¨ | OP_RETURN | æ°¸ä¹…æ•°æ®è®°å½• |

### â“ å¤šé‡ç­¾åçš„å®‰å…¨æ€§å¦‚ä½•ï¼Ÿ

å¤šé‡ç­¾åæ¯”å•ç­¾åæ›´å®‰å…¨ï¼š

```
å®‰å…¨æ€§å¯¹æ¯”ï¼š

å•ç­¾åé£é™©ï¼š
- ç§é’¥ä¸¢å¤± â†’ èµ„é‡‘æ°¸ä¹…ä¸¢å¤±
- ç§é’¥æ³„éœ² â†’ èµ„é‡‘è¢«ç›—

2-of-3å¤šç­¾å®‰å…¨æ€§ï¼š
- 1ä¸ªç§é’¥ä¸¢å¤± â†’ ä»å¯ç”¨å…¶ä»–2ä¸ª
- 1ä¸ªç§é’¥æ³„éœ² â†’ æ”»å‡»è€…ä»éœ€å¦1ä¸ªç§é’¥
- éœ€è¦æ”»å‡»è€…åŒæ—¶è·å¾—2ä¸ªç§é’¥æ‰èƒ½ç›—å–èµ„é‡‘
```

### â“ å¦‚ä½•æ‰¹é‡å¤„ç†å¤šä¸ªäº¤æ˜“ä»¥èŠ‚çœè´¹ç”¨ï¼Ÿ

```python
def create_batch_payment(recipients):
    """åˆ›å»ºæ‰¹é‡æ”¯ä»˜äº¤æ˜“"""
    
    # recipients = [
    #     {"address": "bc1q...", "amount": 0.001},
    #     {"address": "bc1q...", "amount": 0.002},
    #     ...
    # ]
    
    outputs = {}
    for recipient in recipients:
        outputs[recipient["address"]] = recipient["amount"]
    
    # åˆ›å»ºåŒ…å«å¤šä¸ªè¾“å‡ºçš„äº¤æ˜“
    raw_tx = bitcoin_rpc("createrawtransaction", [inputs, outputs])
    return raw_tx
```

## ç»“è¯­

é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œä½ å·²ç»æŒæ¡äº†æ¯”ç‰¹å¸äº¤æ˜“çš„é«˜çº§ç‰¹æ€§ï¼š

- **å¤šé‡ç­¾å**ï¼šç†è§£äº†ä¼ä¸šçº§èµ„é‡‘ç®¡ç†çš„æ ¸å¿ƒæŠ€æœ¯
- **SegWitæŠ€æœ¯**ï¼šæŒæ¡äº†å¦‚ä½•æå‡äº¤æ˜“æ•ˆç‡å’Œé™ä½è´¹ç”¨
- **Taprootå‡çº§**ï¼šäº†è§£äº†æœ€æ–°çš„éšç§å’ŒåŠŸèƒ½å¢å¼º
- **å¤æ‚äº¤æ˜“ç±»å‹**ï¼šå­¦ä¼šäº†å„ç§ç‰¹æ®Šç”¨é€”çš„äº¤æ˜“
- **åœ°å€æ ¼å¼æ¼”è¿›**ï¼šè®¤è¯†äº†æ¯”ç‰¹å¸æŠ€æœ¯å‘å±•çš„å†ç¨‹

è¿™äº›æŠ€æœ¯ä¸ä»…æå‡äº†æ¯”ç‰¹å¸çš„åŠŸèƒ½æ€§å’Œæ•ˆç‡ï¼Œæ›´ä¸ºLayer 2è§£å†³æ–¹æ¡ˆï¼ˆå¦‚é—ªç”µç½‘ç»œï¼‰ã€DeFiåº”ç”¨å’Œå…¶ä»–åˆ›æ–°å¥ å®šäº†åšå®åŸºç¡€ã€‚

åœ¨ä¸‹ä¸€ç« ã€Šæ¯”ç‰¹å¸æ‰©å®¹ä¸æ²»ç†ã€‹ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨æ¯”ç‰¹å¸å†å²ä¸Šçš„æŠ€æœ¯äº‰è®ºã€å‡çº§æœºåˆ¶å’Œç¤¾åŒºæ²»ç†ï¼Œäº†è§£è¿™äº›æŠ€æœ¯æ˜¯å¦‚ä½•åœ¨æ¿€çƒˆçš„è®¨è®ºä¸­è¯ç”Ÿå’Œå‘å±•çš„ã€‚

> ğŸŒŸ **Taprootçš„æ„ä¹‰**ï¼šè¿™ä¸ä»…æ˜¯æŠ€æœ¯å‡çº§ï¼Œæ›´æ˜¯æ¯”ç‰¹å¸å‘"éšç§è´§å¸"å’Œ"æ™ºèƒ½åˆçº¦å¹³å°"æ¼”è¿›çš„é‡è¦ä¸€æ­¥ï¼ŒåŒæ—¶ä¿æŒäº†æ¯”ç‰¹å¸çš„æ ¸å¿ƒåŸåˆ™ï¼šå»ä¸­å¿ƒåŒ–å’Œå®‰å…¨æ€§ã€‚

---

<div align="center">
<a href="https://github.com/beihaili/Get-Started-with-Web3">ğŸ  è¿”å›ä¸»é¡µ</a> | 
<a href="https://twitter.com/bhbtc1337">ğŸ¦ å…³æ³¨ä½œè€…</a> | 
<a href="https://forms.gle/QMBwL6LwZyQew1tX8">ğŸ“ åŠ å…¥äº¤æµç¾¤</a>
</div> 