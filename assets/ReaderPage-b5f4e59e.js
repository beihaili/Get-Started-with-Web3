import{j as e,R as s,r as t,u as a,L as l}from"./react-vendor-d09f2fb9.js";import{u as r}from"./useUserStore-0519b8dd.js";import{u as n,a as i}from"./index-5a1b0142.js";import{C as o,E as c,H as d,U as x,F as m,b as h,X as u,L as p,S as g,a as b,c as f}from"./ui-ee05c837.js";import{C as j}from"./courseData-f0043609.js";import"./store-263a9ded.js";const v=({content:t,basePath:a=""})=>{const l=s=>{if(!s)return null;return s.split(/(<img[^>]+>|<a\s+[^>]*href=["'][^"']+["'][^>]*>.*?<\/a>|!\[.*?\]\(.*?\)|\[.*?\]\(.*?\)|`.*?`|\*\*.*?\*\*)/g).map((s,t)=>{if(!s)return null;if(s.trim().match(/^<\/?div.*?>$/))return null;if(s.match(/^<img/)){const l=s.match(/src=["']([^"']+)["']/),r=s.match(/width\s*=\s*["']?(\d+)["']?/);if(l){let s=l[1];(s.startsWith("./")||s.startsWith("img/"))&&(s=a+s.replace("./",""));const n=r?r[1]:void 0;return e.jsx("span",{className:"inline-flex m-1 align-middle",children:e.jsx("img",{src:s,alt:"Image",className:"rounded-lg max-w-full h-auto",style:{maxHeight:"500px",width:n?`${n}px`:"auto"}})},t)}}const l=s.match(/^<a\s+[^>]*href=["']([^"']+)["'][^>]*>(.*?)<\/a>$/);if(l)return e.jsxs("a",{href:l[1],target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300 underline underline-offset-4 decoration-cyan-500/30 transition-colors inline-flex items-center gap-1 mx-1",children:[l[2]," ",e.jsx(c,{className:"w-3 h-3"})]},t);const r=s.match(/!\[(.*?)\]\((.*?)\)/);if(r){let s=r[2];return s.startsWith("http")||(s=a+s.replace("./","")),e.jsx("span",{className:"inline-flex m-1 align-middle",children:e.jsx("img",{src:s,alt:r[1],className:"rounded-lg max-w-full h-auto shadow-lg",style:{maxHeight:"500px"}})},t)}const n=s.match(/^\[(.*?)\]\((.*?)\)$/);if(n)return e.jsxs("a",{href:n[2],target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300 underline underline-offset-4 decoration-cyan-500/30 transition-colors inline-flex items-center gap-1",children:[n[1]," ",e.jsx(c,{className:"w-3 h-3"})]},t);const i=s.match(/^\*\*(.*?)\*\*$/);if(i)return e.jsx("strong",{className:"text-white font-bold",children:i[1]},t);const o=s.match(/^`(.*?)`$/);return o?e.jsx("code",{className:"bg-slate-800 text-cyan-300 px-1.5 py-0.5 rounded text-sm font-mono border border-slate-700",children:o[1]},t):s})},r=t.split("\n"),n=[];let i=[],h=[];const u=()=>{h.length>0&&(n.push(e.jsx("div",{className:"flex flex-wrap gap-4 justify-center mt-8 pt-8 border-t border-slate-800",children:h.map((s,t)=>e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-5 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-cyan-500/50 rounded-full text-white font-bold text-sm transition-all transform hover:scale-105 shadow-lg group",children:[s.text.includes("ğŸ ")&&e.jsx(d,{className:"w-4 h-4 text-cyan-400 group-hover:text-white transition-colors"}),s.text.includes("ğŸ¦")&&e.jsx(x,{className:"w-4 h-4 text-cyan-400 group-hover:text-white transition-colors"}),s.text.includes("ğŸ“")&&e.jsx(m,{className:"w-4 h-4 text-cyan-400 group-hover:text-white transition-colors"}),e.jsx("span",{children:s.text.replace(/ğŸ |ğŸ¦|ğŸ“/g,"").trim()})]},t))},`footer-${n.length}`)),h=[])},p=()=>{if(i.length>0){i.every(e=>e.match(/<img|!\[/))?n.push(e.jsx("div",{className:"flex flex-wrap justify-center gap-2 my-6",children:i.map((t,a)=>e.jsx(s.Fragment,{children:l(t)},a))},`badges-${n.length}`)):n.push(e.jsx("div",{className:"mb-4 text-slate-300 leading-7",children:i.map((t,a)=>e.jsxs(s.Fragment,{children:[l(t),a<i.length-1&&e.jsx("br",{})]},a))},`text-${n.length}`)),i=[]}};return r.forEach((s,t)=>{const a=s.trim();if(!a||"</div>"===a||'<div align="center">'===a||a.match(/^[-|]+$/))return void p();if(a.includes("è¿”å›ä¸»é¡µ")||a.includes("å…³æ³¨ä½œè€…")||a.includes("åŠ å…¥äº¤æµç¾¤")){p();const e=a.match(/\[(.*?)\]\((.*?)\)/),s=a.match(/href=["'](.*?)["']>(.*?)<\/a>/);return void(s?h.push({text:s[2],url:s[1]}):e&&h.push({text:e[1],url:e[2]}))}const r=a.match(/^#{1,6}\s/),c=a.match(/^(\*|-|\d\.)\s/),d=a.startsWith(">"),x=a.startsWith("```"),m=a.startsWith("//")||a.startsWith("const")||a.startsWith("import")||a.startsWith("$")||a.startsWith("npm");if(r||c||d||x||m)if(p(),u(),r)s.startsWith("# ")?n.push(e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mt-12 mb-8 border-b border-slate-800 pb-4",children:l(s.slice(2))},t)):s.startsWith("## ")?n.push(e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white mt-10 mb-6",children:l(s.slice(3))},t)):s.startsWith("### ")?n.push(e.jsxs("h3",{className:"text-xl md:text-2xl font-bold text-cyan-400 mt-8 mb-4 flex items-center gap-2",children:[e.jsx(o,{className:"w-5 h-5"}),l(s.slice(4))]},t)):s.startsWith("#### ")&&n.push(e.jsx("h4",{className:"text-lg md:text-xl font-bold text-cyan-200 mt-6 mb-3 pl-4 border-l-2 border-cyan-500/30",children:l(s.slice(5))},t));else if(c)if(a.match(/^(\*|-)\s/))n.push(e.jsxs("div",{className:"ml-4 flex items-start gap-3 mb-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500 mt-2.5 shrink-0"}),e.jsx("div",{className:"flex-1",children:l(a.substring(2))})]},t));else{const s=a.match(/^(\d\.)\s(.*)/);s&&n.push(e.jsxs("div",{className:"ml-4 flex gap-3 mb-1",children:[e.jsx("span",{className:"font-bold text-cyan-500 shrink-0 font-mono",children:s[1]}),e.jsx("div",{className:"flex-1",children:l(s[2])})]},t))}else d?n.push(e.jsx("blockquote",{className:"border-l-4 border-cyan-500/30 bg-slate-900/50 p-4 text-slate-400 rounded-r-lg my-4 text-base italic",children:l(a.slice(2))},t)):m&&n.push(e.jsx("div",{className:"bg-slate-950 p-4 rounded-lg font-mono text-sm border border-slate-800 my-4 text-green-400 overflow-x-auto shadow-inner whitespace-pre",children:s},t));else i.push(s)}),p(),u(),e.jsx("div",{className:"font-sans text-base",children:n})};const y=({lessonContext:s=""})=>{const{geminiApiKey:a}=n(),[l,r]=t.useState(!1),[i,o]=t.useState([]),[c,d]=t.useState(""),[x,m]=t.useState(!1),b=async()=>{if(!c.trim()||!a)return void(a||alert("AI åŠ©æ•™éœ€è¦é…ç½® Gemini API Keyã€‚"));const e={role:"user",content:c};o(s=>[...s,e]),d(""),m(!0);try{const e=s.slice(0,1500),t=`å­¦ç”Ÿé—®é¢˜: "${c}"\n\nåŸºäºå½“å‰è¯¾ç¨‹å†…å®¹å›ç­”å­¦ç”Ÿçš„é—®é¢˜ã€‚è¯¾ç¨‹å†…å®¹ï¼š\n${e}\n\nè¯·æä¾›æ¸…æ™°ã€æ˜“æ‡‚çš„è§£é‡Šï¼Œå¦‚æœé—®é¢˜ä¸å½“å‰è¯¾ç¨‹ç›¸å…³ï¼Œè¦ç»“åˆè¯¾ç¨‹å†…å®¹ã€‚å¦‚æœé—®é¢˜è¶…å‡ºè¯¾ç¨‹èŒƒå›´ï¼Œå¯ä»¥é€‚å½“æ‰©å±•ä½†è¦è¯´æ˜ã€‚`,a="ä½ æ˜¯ä¸€ä¸ªå‹å–„çš„Web3æ•™è‚²åŠ©æ•™ã€‚ç”¨ä¸­æ–‡å›ç­”ï¼Œè¯­è¨€è¦é€šä¿—æ˜“æ‡‚ï¼Œå¯ä»¥ä½¿ç”¨è¡¨æƒ…ç¬¦å·è®©å›ç­”æ›´ç”ŸåŠ¨ã€‚",l=await async function(e,s="",t=!1){var a,l,r,n,i;const o=localStorage.getItem("gemini-api-key");if(!o)throw new Error("è¯·å…ˆé…ç½®æ‚¨çš„ Gemini API Key");try{const c={contents:[{parts:[{text:e}]}],systemInstruction:{parts:[{text:s}]},generationConfig:{responseMimeType:t?"application/json":"text/plain"}},d=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),x=await d.json();if(x.error)throw(x.error.message.includes("API_KEY")||x.error.message.includes("invalid"))&&localStorage.removeItem("gemini-api-key"),new Error(x.error.message);return(null==(i=null==(n=null==(r=null==(l=null==(a=x.candidates)?void 0:a[0])?void 0:l.content)?void 0:r.parts)?void 0:n[0])?void 0:i.text)||"No response"}catch(c){throw c}}(t,a),r={role:"assistant",content:l};o(e=>[...e,r])}catch(t){const e={role:"assistant",content:`æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼š${t.message}`};o(s=>[...s,e])}m(!1)};return l?e.jsxs("div",{className:"fixed bottom-6 right-6 z-50 w-80 max-h-96 bg-slate-900/95 backdrop-blur-xl border border-slate-700/50 rounded-2xl shadow-2xl shadow-cyan-500/10",children:[e.jsxs("div",{className:"p-4 border-b border-slate-700/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-purple-400"}),e.jsx("h3",{className:"font-bold text-white",children:"AI åŠ©æ•™"})]}),e.jsx("button",{onClick:()=>r(!1),className:"text-slate-400 hover:text-white",children:e.jsx(u,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"h-64 overflow-y-auto p-4 space-y-3",children:[0===i.length&&e.jsx("div",{className:"text-slate-400 text-sm text-center py-8",children:"ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯AIåŠ©æ•™ï¼Œæœ‰ä»»ä½•å…³äºè¯¾ç¨‹çš„é—®é¢˜éƒ½å¯ä»¥é—®æˆ‘å“¦~"}),i.map((s,t)=>e.jsx("div",{className:"flex "+("user"===s.role?"justify-end":"justify-start"),children:e.jsx("div",{className:"max-w-xs p-3 rounded-lg text-sm "+("user"===s.role?"bg-cyan-600 text-white":"bg-slate-800 text-slate-200"),children:s.content})},t)),x&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"bg-slate-800 text-slate-200 p-3 rounded-lg text-sm flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 animate-spin"}),"æ€è€ƒä¸­..."]})})]}),e.jsx("div",{className:"p-4 border-t border-slate-700/50",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),onKeyPress:e=>"Enter"===e.key&&b(),placeholder:"é—®æˆ‘ä»»ä½•é—®é¢˜...",className:"flex-1 bg-slate-800 border border-slate-600 text-slate-200 text-sm rounded px-3 py-2 focus:outline-none focus:border-cyan-500"}),e.jsx("button",{onClick:b,disabled:!c.trim()||x,className:"bg-cyan-600 hover:bg-cyan-500 disabled:bg-slate-600 text-white p-2 rounded transition-colors",children:e.jsx(g,{className:"w-4 h-4"})})]})})]}):e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{onClick:()=>r(!0),className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 text-white p-4 rounded-full shadow-2xl shadow-purple-500/20 transition-all transform hover:scale-105",children:e.jsx(h,{className:"w-6 h-6"})})})},N=()=>{const{moduleId:s,lessonId:n}=a(),{markLessonComplete:o,getLessonProgress:c}=r(),{fetchLessonContent:d}=i(),[x,m]=t.useState(""),[h,u]=t.useState(!0),[g,N]=t.useState(null),[w,k]=t.useState(""),$=`${s}-${n}`,C=c($),W=j.find(e=>e.id===s),S=null==W?void 0:W.lessons.find(e=>e.id===n);t.useEffect(()=>{if(window.scrollTo(0,0),!S)return N("è¯¾ç¨‹ä¸å­˜åœ¨"),void u(!1);(async()=>{u(!0),N(null);try{const e=await d(S.path);m(e||S.fallbackContent||"# å†…å®¹åŠ è½½ä¸­...");const s=S.path.split("/").slice(0,-1).join("/")+"/";k(`/Get-Started-with-Web3/${s}`)}catch(e){N(e.message),m(S.fallbackContent||"# å†…å®¹åŠ è½½å¤±è´¥")}finally{u(!1)}})()},[s,n,S,d]);const I=(null==W?void 0:W.lessons.findIndex(e=>e.id===n))??-1,P=I>0?W.lessons[I-1]:null,A=I<((null==W?void 0:W.lessons.length)??0)-1?W.lessons[I+1]:null;return e.jsxs("div",{className:"min-h-screen bg-slate-950",children:[e.jsx("div",{className:"sticky top-0 z-10 border-b border-slate-800 bg-slate-950/80 backdrop-blur-md",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsxs(l,{to:"/dashboard",className:"flex items-center gap-2 text-slate-400 hover:text-cyan-400 transition-colors",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{children:"è¿”å›è¯¾ç¨‹"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-slate-400 text-sm",children:null==W?void 0:W.title}),C?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-green-500/10 border border-green-500/20 rounded-lg",children:[e.jsx(f,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-green-400 text-sm font-medium",children:"å·²å®Œæˆ"})]}):e.jsx("button",{onClick:()=>{o($)},className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors text-sm font-medium",children:"æ ‡è®°ä¸ºå·²å®Œæˆ"})]})]})}),e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:e.jsx("div",{className:"p-8 bg-slate-900/60 backdrop-blur-md border border-slate-700/50 rounded-xl",children:h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(p,{className:"w-12 h-12 text-cyan-400 animate-spin mb-4"}),e.jsx("p",{className:"text-slate-400",children:"åŠ è½½è¯¾ç¨‹å†…å®¹ä¸­..."})]}):g?e.jsx("div",{className:"p-6 bg-red-500/10 border border-red-500/20 rounded-lg",children:e.jsxs("p",{className:"text-red-400",children:[e.jsx("strong",{children:"åŠ è½½å¤±è´¥ï¼š"})," ",g]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"inline-block px-3 py-1 bg-cyan-500/10 border border-cyan-500/20 rounded-full mb-4",children:e.jsx("span",{className:"text-cyan-400 text-sm font-medium",children:null==W?void 0:W.title})}),e.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:null==S?void 0:S.title})]}),e.jsx("div",{className:"prose prose-invert max-w-none",children:e.jsx(v,{content:x,basePath:w})}),e.jsxs("div",{className:"flex gap-4 mt-8 pt-8 border-t border-slate-700",children:[P?e.jsx(l,{to:`/learn/${s}/${P.id}`,className:"px-6 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition-colors",children:"â† ä¸Šä¸€è®²"}):e.jsx("div",{className:"px-6 py-2 bg-slate-800/50 text-slate-600 rounded-lg cursor-not-allowed",children:"â† ä¸Šä¸€è®²"}),A?e.jsx(l,{to:`/learn/${s}/${A.id}`,className:"px-6 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors ml-auto",children:"ä¸‹ä¸€è®² â†’"}):e.jsx("div",{className:"px-6 py-2 bg-slate-800/50 text-slate-600 rounded-lg cursor-not-allowed ml-auto",children:"ä¸‹ä¸€è®² â†’"})]})]})})}),e.jsx(y,{lessonContext:x})]})};export{N as default};
