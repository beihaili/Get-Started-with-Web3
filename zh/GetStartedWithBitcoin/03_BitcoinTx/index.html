
<!DOCTYPE HTML>
<html lang="zh-hans" >
    <head>
        <meta charset="UTF-8">
        <title>第03讲：比特币交易基础 · Web3入门指南</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 6.0.3">
        <meta name="author" content="beihaili">
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-fontsettings/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/@honkit/honkit-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../styles/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../04_MultiSig/" />
    
    
    <link rel="prev" href="../02_Overview/" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="输入并搜索" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    介绍
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Web3 快速入门</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../Web3QuickStart/01_FirstWeb3Identity/">
            
                <a href="../../Web3QuickStart/01_FirstWeb3Identity/">
            
                    
                    创建你的第一个 Web3 身份
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../Web3QuickStart/02_FirstWeb3Transaction/">
            
                <a href="../../Web3QuickStart/02_FirstWeb3Transaction/">
            
                    
                    进行你的第一笔 Web3 交易
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../Web3QuickStart/03_FirstWeb3Dapp/">
            
                <a href="../../Web3QuickStart/03_FirstWeb3Dapp/">
            
                    
                    构建你的第一个 Web3 DApp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../../Web3QuickStart/04_UsefulWeb3Sites/">
            
                <a href="../../Web3QuickStart/04_UsefulWeb3Sites/">
            
                    
                    有用的 Web3 站点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../../Web3QuickStart/05_LaunchYourFirstToken/">
            
                <a href="../../Web3QuickStart/05_LaunchYourFirstToken/">
            
                    
                    发行你的第一个代币
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../../Web3QuickStart/06_Web3Security/">
            
                <a href="../../Web3QuickStart/06_Web3Security/">
            
                    
                    Web3安全防护与防骗指南
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">比特币技术入门</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../">
            
                <a href="../">
            
                    
                    📋 技术架构总览
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">🔐 第一层：密码学基础层</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../01_Cryptography/">
            
                <a href="../01_Cryptography/">
            
                    
                    第01讲：密码学基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../02_Overview/">
            
                <a href="../02_Overview/">
            
                    
                    第02讲：比特币概述
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">📊 第二层：数据层</li>
        
        
    
        <li class="chapter active" data-level="5.1" data-path="./">
            
                <a href="./">
            
                    
                    第03讲：比特币交易基础
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../04_MultiSig/">
            
                <a href="../04_MultiSig/">
            
                    
                    第04讲：多重签名交易
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../05_SegWit/">
            
                <a href="../05_SegWit/">
            
                    
                    第05讲：隔离见证(SegWit)技术
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../06_Taproot/">
            
                <a href="../06_Taproot/">
            
                    
                    第06讲：Taproot升级详解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../07_AdvancedTransactions/">
            
                <a href="../07_AdvancedTransactions/">
            
                    
                    第07讲：高级交易应用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../08_DataStructure/">
            
                <a href="../08_DataStructure/">
            
                    
                    第08讲：区块链数据结构
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">🌐 第三层：网络层</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../09_BitcoinCore/">
            
                <a href="../09_BitcoinCore/">
            
                    
                    第09讲：比特币核心节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.2" data-path="../10_P2PProtocol/">
            
                <a href="../10_P2PProtocol/">
            
                    
                    第10讲：P2P网络协议
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="6.3" data-path="../11_NetworkSecurity/">
            
                <a href="../11_NetworkSecurity/">
            
                    
                    第11讲：网络安全
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">🤝 第四层：共识层</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../12_ProofOfWork/">
            
                <a href="../12_ProofOfWork/">
            
                    
                    第12讲：工作量证明与挖矿
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../13_DifficultyAdjustment/">
            
                <a href="../13_DifficultyAdjustment/">
            
                    
                    第13讲：难度调整算法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="../14_ForksBIPs/">
            
                <a href="../14_ForksBIPs/">
            
                    
                    第14讲：分叉机制与BIP流程
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">💼 第五层：应用层</li>
        
        
    
        <li class="chapter " data-level="8.1" data-path="../15_BitcoinWallet/">
            
                <a href="../15_BitcoinWallet/">
            
                    
                    第15讲：比特币钱包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="../16_BitcoinRPC/">
            
                <a href="../16_BitcoinRPC/">
            
                    
                    第16讲：比特币RPC应用开发
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="../17_BitcoinLowFeeBroadcast/">
            
                <a href="../17_BitcoinLowFeeBroadcast/">
            
                    
                    第17讲：比特币低费率广播工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="../18_BitcoinScript/">
            
                <a href="../18_BitcoinScript/">
            
                    
                    第18讲：Bitcoin Script脚本系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="../19_BitcoinGovernance/">
            
                <a href="../19_BitcoinGovernance/">
            
                    
                    第19讲：比特币扩容与治理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="../20_Ordinals/">
            
                <a href="../20_Ordinals/">
            
                    
                    第20讲：Ordinals与生态创新
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="../21_DeFiCrossChain/">
            
                <a href="../21_DeFiCrossChain/">
            
                    
                    第21讲：DeFi跨链
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">其它学习资源整理</li>
        
        
    
        <li class="chapter " data-level="9.1" data-path="../../其它学习资源整理/Etherum/">
            
                <a href="../../其它学习资源整理/Etherum/">
            
                    
                    以太坊学习指南
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="../../其它学习资源整理/DeFi/">
            
                <a href="../../其它学习资源整理/DeFi/">
            
                    
                    DeFi学习指南
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Web3 思考</li>
        
        
    
        <li class="chapter " data-level="10.1" data-path="../../Web3Thoughts/01_Principles/">
            
                <a href="../../Web3Thoughts/01_Principles/">
            
                    
                    Web3 原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.2" data-path="../../Web3Thoughts/02_WhyBlockchainIsNecessary/">
            
                <a href="../../Web3Thoughts/02_WhyBlockchainIsNecessary/">
            
                    
                    为什么区块链是必须的？《主权个人》读书笔记
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="10.3" data-path="../../Web3Thoughts/03_TheCoolestTransactionOnBitcoin/">
            
                <a href="../../Web3Thoughts/03_TheCoolestTransactionOnBitcoin/">
            
                    
                    区块链彩蛋解读指南：b10c...eb5d 玩了哪些「梗」？
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Web3 工作机会</li>
        
        
    
        <li class="chapter " data-level="11.1" data-path="../../Web3WorkOpportunities/">
            
                <a href="../../Web3WorkOpportunities/">
            
                    
                    Web3 工作机会
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">我们的研究报告</li>
        
        
    
        <li class="chapter " data-level="12.1" data-path="../../OurResearch/Search01_BscAttack/">
            
                <a href="../../OurResearch/Search01_BscAttack/">
            
                    
                    BSC 链上的攻击：为何发生及其潜在的危害
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            本书使用 HonKit 发布
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >第03讲：比特币交易基础</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="第03讲：比特币交易基础">第03讲：比特币交易基础</h1>
<p><img src="https://img.shields.io/badge/状态-已完成-success" alt="status"></img>
<img src="https://img.shields.io/badge/作者-beihaili-blue" alt="author"></img>
<img src="https://img.shields.io/badge/日期-2025--06-orange" alt="date"></img>
<img src="https://img.shields.io/badge/难度-初级-green" alt="difficulty"></img></p>
<blockquote>
<p>💡 自学入门 <code>Web3</code> 不是一件容易的事，作为一个刚刚入门 Web3 的新人，梳理一下最简单直观的 <code>Web3</code> 小白入门教程。整合开源社区优质资源，为大家从入门到精通 Web3 指路。每周更新 1-3 讲。</p>
<p>欢迎关注我的推特：<a href="https://twitter.com/bhbtc1337" target="_blank">@bhbtc1337</a></p>
<p>进入微信交流群请填表：<a href="https://forms.gle/QMBwL6LwZyQew1tX8" target="_blank">表格链接</a></p>
<p>文章开源在 GitHub：<a href="https://github.com/beihaili/Get-Started-with-Web3" target="_blank">Get-Started-with-Web3</a></p>
<p>购买BTC/ETH/USDT 等加密货币推荐 <a href="https://www.binance.com/zh-CN" target="_blank">币安</a><a href="https://accounts.marketwebb.me/register?ref=39797374" target="_blank">注册链接</a></p>
</blockquote>
<h2 id="目录">目录</h2>
<ul>
<li><a href="#前言为什么银行的记账方式不适合比特币">前言：为什么银行的记账方式不适合比特币？</a></li>
<li><a href="#utxo模型现金vs银行账户的哲学">UTXO模型：现金vs银行账户的哲学</a></li>
<li><a href="#交易结构数字化的现金流转">交易结构：数字化的现金流转</a></li>
<li><a href="#输入与输出钱从哪里来到哪里去">输入与输出：钱从哪里来到哪里去</a></li>
<li><a href="#交易验证数学如何保证安全">交易验证：数学如何保证安全</a></li>
<li><a href="#实际操作手把手创建交易">实际操作：手把手创建交易</a></li>
<li><a href="#常见问题">常见问题</a></li>
<li><a href="#结语">结语</a></li>
</ul>
<h2 id="前言：为什么银行的记账方式不适合比特币？">前言：为什么银行的记账方式不适合比特币？</h2>
<p>想象你在管理一个完全没有信任的环境中的资金流转——比如一群互不认识的人之间要记录借贷关系，但没有任何中央机构来监督。</p>
<p><strong>传统银行方式：</strong></p>
<pre><code>Alice账户：余额 100 BTC
Bob账户：余额 50 BTC

Alice转给Bob 10 BTC：
Alice账户：100 - 10 = 90 BTC ✅
Bob账户：50 + 10 = 60 BTC ✅
</code></pre><p><strong>问题来了：</strong></p>
<ul>
<li>谁来保证Alice真的有100 BTC？</li>
<li>谁来防止Alice同时告诉多个人"我有100 BTC"？</li>
<li>如果没有银行，如何防止双重支付？</li>
</ul>
<p><strong>比特币的解决方案：不记录余额，只记录现金流转</strong></p>
<p>就像用现金一样：</p>
<ul>
<li>你口袋里有几张纸币，每张都有编号</li>
<li>要花钱时，必须拿出具体的纸币</li>
<li>别人能验证这张纸币确实是你的，且没有被花掉过</li>
</ul>
<p>这就是比特币的UTXO（未花费交易输出）模型的核心思想。</p>
<h2 id="utxo模型：现金vs银行账户的哲学">UTXO模型：现金vs银行账户的哲学</h2>
<h3 id="为什么选择现金模式？">为什么选择"现金模式"？</h3>
<p><strong>银行账户模式的问题：</strong></p>
<ul>
<li>需要中央权威维护账户余额</li>
<li>容易出现双重支付（同一笔钱花两次）</li>
<li>需要复杂的锁定和同步机制</li>
<li>难以在分布式环境中达成共识</li>
</ul>
<p><strong>现金模式的优势：</strong></p>
<ul>
<li>每张"纸币"都有独立身份</li>
<li>花掉就销毁，无法重复使用</li>
<li>容易验证：检查纸币是否存在且未使用</li>
<li>天然防止双重支付</li>
</ul>
<h3 id="utxo模型详解">UTXO模型详解</h3>
<p><strong>核心概念：</strong></p>
<pre><code>UTXO = 一张还没花掉的"数字纸币"
每个UTXO包含：
- 金额：这张"纸币"值多少钱
- 锁定条件：谁能花掉这张"纸币"
</code></pre><p><strong>实际例子：</strong></p>
<pre><code>Alice的"钱包"里有：
- UTXO1: 30 BTC（来自工资）
- UTXO2: 70 BTC（来自投资收益）
总财富：100 BTC

Alice要给Bob转50 BTC：
❌ 不能直接"减少余额"
✅ 必须选择具体的UTXO来花费
</code></pre><p><img src="img/txchain.png" alt="交易链条图示"></img></p>
<h3 id="转账过程：数字破钱找零">转账过程：数字"破钱找零"</h3>
<p><strong>场景：</strong>Alice用70 BTC的UTXO买50 BTC的东西</p>
<pre><code class="lang-json">{
  <span class="hljs-string">"inputs"</span>: [
    {<span class="hljs-string">"previous_utxo"</span>: <span class="hljs-string">"70 BTC"</span>, <span class="hljs-string">"owner"</span>: <span class="hljs-string">"Alice"</span>}
  ],
  <span class="hljs-string">"outputs"</span>: [
    {<span class="hljs-string">"amount"</span>: <span class="hljs-string">"50 BTC"</span>, <span class="hljs-string">"recipient"</span>: <span class="hljs-string">"Bob"</span>},
    {<span class="hljs-string">"amount"</span>: <span class="hljs-string">"19.99 BTC"</span>, <span class="hljs-string">"recipient"</span>: <span class="hljs-string">"Alice（找零地址）"</span>}
  ],
  <span class="hljs-string">"fee"</span>: <span class="hljs-string">"0.01 BTC"</span>
}
</code></pre>
<p><strong>结果：</strong></p>
<ul>
<li>Alice的70 BTC UTXO被"销毁"</li>
<li>创建两个新UTXO：Bob的50 BTC + Alice的19.99 BTC</li>
<li>0.01 BTC给矿工作为手续费</li>
</ul>
<p>这就像你用100元纸币买了50元东西，收银员：</p>
<ol>
<li>收走你的100元纸币（销毁旧UTXO）</li>
<li>给商家50元（新UTXO）</li>
<li>找给你49元（找零UTXO）</li>
<li>1元作为"服务费"</li>
</ol>
<h3 id="深入技术细节：utxo集合管理">深入技术细节：UTXO集合管理</h3>
<p><strong>UTXO集合的数据结构：</strong></p>
<pre><code>全网UTXO集合 = {
    "txid1:vout0": {value: 1.5, scriptPubKey: "..."},
    "txid2:vout1": {value: 0.8, scriptPubKey: "..."},
    "txid3:vout0": {value: 2.1, scriptPubKey: "..."},
    ...
}
</code></pre><p><strong>关键特性：</strong></p>
<ul>
<li><strong>唯一标识</strong>：每个UTXO用"交易ID:输出索引"唯一标识</li>
<li><strong>原子操作</strong>：UTXO要么完全存在，要么完全不存在</li>
<li><strong>无需排序</strong>：UTXO之间没有先后关系</li>
<li><strong>并行验证</strong>：不同UTXO可以并行验证</li>
</ul>
<p><strong>与银行模式对比：</strong></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>银行账户模式</th>
<th>UTXO模式</th>
</tr>
</thead>
<tbody>
<tr>
<td>状态存储</td>
<td>账户余额</td>
<td>未花费输出集合</td>
</tr>
<tr>
<td>支付方式</td>
<td>余额扣减</td>
<td>UTXO消费+新建</td>
</tr>
<tr>
<td>双重支付防护</td>
<td>数据库锁</td>
<td>密码学证明</td>
</tr>
<tr>
<td>并行处理</td>
<td>困难（需要锁定账户）</td>
<td>容易（独立UTXO）</td>
</tr>
<tr>
<td>隐私保护</td>
<td>差（账户关联）</td>
<td>好（地址分离）</td>
</tr>
</tbody>
</table>
<h2 id="交易结构：数字化的现金流转">交易结构：数字化的现金流转</h2>
<h3 id="交易的构成要素">交易的构成要素</h3>
<p>每笔比特币交易就像一张复杂的"转账凭证"：</p>
<p><img src="img/tx.png" alt="交易结构图"></img></p>
<p><strong>基本组成：</strong></p>
<pre><code>交易 = 输入列表 + 输出列表 + 元数据
</code></pre><p><strong>具体结构：</strong></p>
<pre><code class="lang-json">{
  <span class="hljs-string">"txid"</span>: <span class="hljs-string">"f4184fc596403b9d638783cf57adfe4c75c605f6356fbc91338530e9831e9e16"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-number">1</span>,
  <span class="hljs-string">"locktime"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"vin"</span>: [输入数组],
  <span class="hljs-string">"vout"</span>: [输出数组]
}
</code></pre>
<h3 id="深入技术细节：交易二进制格式">深入技术细节：交易二进制格式</h3>
<p><strong>交易的线性化格式：</strong></p>
<pre><code>[4字节版本] [变长输入数量] [输入数据...] [变长输出数量] [输出数据...] [4字节锁定时间]
</code></pre><p><strong>序列化过程：</strong></p>
<ol>
<li><strong>版本号</strong>：定义交易解析规则</li>
<li><strong>输入计数</strong>：使用变长整数编码</li>
<li><strong>输入数据</strong>：按顺序序列化每个输入</li>
<li><strong>输出计数</strong>：使用变长整数编码</li>
<li><strong>输出数据</strong>：按顺序序列化每个输出</li>
<li><strong>锁定时间</strong>：4字节时间戳或区块高度</li>
</ol>
<p><strong>变长整数编码：</strong></p>
<pre><code>&lt; 0xFD: 1字节直接表示
0xFD: 2字节表示
0xFE: 4字节表示  
0xFF: 8字节表示
</code></pre><h2 id="输入与输出：钱从哪里来到哪里去">输入与输出：钱从哪里来到哪里去</h2>
<h3 id="交易输入：证明我有钱花">交易输入：证明"我有钱花"</h3>
<p>每个输入就像一张"取钱凭证"：</p>
<pre><code class="lang-json">{
  <span class="hljs-string">"txid"</span>: <span class="hljs-string">"0437cd7f8525ceed2324359c2d0ba26006d92d856a9c20fa0241106ee5a597c9"</span>,
  <span class="hljs-string">"vout"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"scriptSig"</span>: {
    <span class="hljs-string">"asm"</span>: <span class="hljs-string">"3045022100... 0279be667ef9dcbb..."</span>,
    <span class="hljs-string">"hex"</span>: <span class="hljs-string">"483045022100...21036873b4df35e5b6a967cf7ed4e6a9b6e0a6e2ff7c7b99ee1a8e6a4e4b1b6d6d6d"</span>
  },
  <span class="hljs-string">"sequence"</span>: <span class="hljs-number">4294967295</span>
}
</code></pre>
<p><strong>字段解释：</strong></p>
<ul>
<li><strong>TXID</strong>：指向之前交易的"身份证号"</li>
<li><strong>VOUT</strong>：指定要花费的具体输出（第几个）</li>
<li><strong>ScriptSig</strong>：包含数字签名和公钥的"所有权证明"</li>
<li><strong>Sequence</strong>：序列号，用于高级功能</li>
</ul>
<p><strong>关键理解：ScriptSig的工作原理</strong></p>
<pre><code>ScriptSig = [数字签名] [公钥]

验证过程：
1. 提取公钥，计算对应的比特币地址
2. 检查这个地址是否匹配被花费UTXO的锁定条件
3. 使用公钥验证数字签名是否正确
4. 确认签名对应的是当前交易的内容
</code></pre><h3 id="交易输出：指定钱给谁">交易输出：指定"钱给谁"</h3>
<p>每个输出就像一张"存钱凭证"：</p>
<pre><code class="lang-json">{
  <span class="hljs-string">"value"</span>: <span class="hljs-number">0.01000000</span>,
  <span class="hljs-string">"n"</span>: <span class="hljs-number">0</span>,
  <span class="hljs-string">"scriptPubKey"</span>: {
    <span class="hljs-string">"asm"</span>: <span class="hljs-string">"OP_DUP OP_HASH160 389ffce9cd9ae88dcc0631e88a821ffdbe9bfe26 OP_EQUALVERIFY OP_CHECKSIG"</span>,
    <span class="hljs-string">"hex"</span>: <span class="hljs-string">"76a914389ffce9cd9ae88dcc0631e88a821ffdbe9bfe2688ac"</span>,
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"pubkeyhash"</span>,
    <span class="hljs-string">"address"</span>: <span class="hljs-string">"16CQL6VEW2RWkZ9WfGS8NhisDVZi5tCZRE"</span>
  }
}
</code></pre>
<p><strong>字段解释：</strong></p>
<ul>
<li><strong>Value</strong>：金额（以聪为单位，1 BTC = 100,000,000 聪）</li>
<li><strong>ScriptPubKey</strong>：锁定脚本，定义"解锁条件"</li>
<li><strong>Address</strong>：对应的比特币地址（便于人类理解）</li>
</ul>
<p><strong>P2PKH锁定脚本详解：</strong></p>
<pre><code>OP_DUP OP_HASH160 &lt;公钥哈希&gt; OP_EQUALVERIFY OP_CHECKSIG

翻译成人话：
"谁能提供一个公钥，使得：
1. 公钥的哈希等于指定值
2. 用这个公钥能验证提供的签名
谁就能花费这笔钱"
</code></pre><h3 id="为什么需要输入和输出都有脚本？">为什么需要输入和输出都有脚本？</h3>
<p><strong>双重验证机制：</strong></p>
<pre><code>输出脚本（锁）："必须是Alice才能花费"
输入脚本（钥匙）："我是Alice，这是我的证明"

验证过程：
锁 + 钥匙 → 数学运算 → True/False
</code></pre><p>这就像：</p>
<ul>
<li><strong>输出脚本</strong>是保险箱上的锁，定义开锁条件</li>
<li><strong>输入脚本</strong>是钥匙和密码，证明你能开锁</li>
</ul>
<h2 id="交易验证：数学如何保证安全">交易验证：数学如何保证安全</h2>
<h3 id="为什么需要验证？">为什么需要验证？</h3>
<p>在没有中央银行的世界里，每个人都要自己验证收到的钱是否"真钱"：</p>
<p><strong>需要检查的问题：</strong></p>
<ul>
<li>这笔钱是否真的存在？</li>
<li>转账的人是否真的拥有这笔钱？</li>
<li>这笔钱之前是否已经被花掉了？</li>
<li>签名是否正确？</li>
</ul>
<h3 id="验证的四个层次">验证的四个层次</h3>
<h4 id="1-格式验证：基本合规检查">1. 格式验证：基本合规检查</h4>
<pre><code>检查项目：
- 交易结构是否完整
- 字段类型是否正确
- 数据长度是否合理
- 是否符合协议规范
</code></pre><h4 id="2-utxo验证：钱是否真实存在">2. UTXO验证：钱是否真实存在</h4>
<pre><code>检查项目：
- 输入引用的UTXO是否存在于UTXO集合中
- 被引用的UTXO是否已经被花费
- 输入金额是否足够支付输出金额
</code></pre><h4 id="3-脚本验证：密码学证明">3. 脚本验证：密码学证明</h4>
<pre><code>验证过程：
输入脚本 + 输出脚本 → 脚本引擎执行 → True/False

具体对于P2PKH：
1. 提取输入脚本中的公钥和签名
2. 计算公钥哈希，与输出脚本中的哈希比较
3. 使用公钥验证签名是否正确
4. 确认签名对应当前交易内容
</code></pre><h4 id="4-经济规则验证：数学平衡">4. 经济规则验证：数学平衡</h4>
<pre><code>检查项目：
- 输出总额 ≤ 输入总额
- 矿工费 = 输入总额 - 输出总额 ≥ 0
- 单个输出金额 &gt; 0
- 总金额不超过2100万BTC限制
</code></pre><h3 id="深入技术：脚本验证引擎">深入技术：脚本验证引擎</h3>
<p><strong>比特币脚本是基于栈的编程语言：</strong></p>
<pre><code>P2PKH验证过程（栈操作）：

初始栈：[]
执行输入脚本：[签名] [公钥]
栈状态：[签名, 公钥]

执行输出脚本：
OP_DUP → [签名, 公钥, 公钥]
OP_HASH160 → [签名, 公钥, 公钥哈希]
&lt;目标哈希&gt; → [签名, 公钥, 公钥哈希, 目标哈希]
OP_EQUALVERIFY → [签名, 公钥] (如果哈希匹配)
OP_CHECKSIG → [True] (如果签名验证成功)

最终：栈顶为True表示验证通过
</code></pre><h2 id="实际操作：手把手创建交易">实际操作：手把手创建交易</h2>
<h3 id="第一步：查看可用资金">第一步：查看可用资金</h3>
<pre><code class="lang-python"><span class="hljs-comment"># 查看UTXO（相当于查看钱包里有哪些纸币）</span>
utxos = rpc.listunspent()
<span class="hljs-keyword">for</span> utxo <span class="hljs-keyword">in</span> utxos:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"UTXO: <span class="hljs-subst">{utxo[<span class="hljs-string">'amount'</span>]}</span> BTC (来自 <span class="hljs-subst">{utxo[<span class="hljs-string">'txid'</span>][:<span class="hljs-number">8</span>]}</span>...)"</span>)
</code></pre>
<h3 id="第二步：选择要花费的utxo">第二步：选择要花费的UTXO</h3>
<pre><code class="lang-python"><span class="hljs-comment"># 选择足够大的UTXO（相当于选择一张足够大的纸币）</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">select_utxo</span>(<span class="hljs-params">utxos, target_amount</span>):
    <span class="hljs-keyword">for</span> utxo <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(utxos, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">'amount'</span>], reverse=<span class="hljs-literal">True</span>):
        <span class="hljs-keyword">if</span> utxo[<span class="hljs-string">'amount'</span>] &gt;= target_amount:
            <span class="hljs-keyword">return</span> utxo
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h3 id="第三步：构造交易">第三步：构造交易</h3>
<pre><code class="lang-python"><span class="hljs-comment"># 创建交易结构</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_transaction</span>(<span class="hljs-params">from_utxo, to_address, amount</span>):
    inputs = [{
        <span class="hljs-string">"txid"</span>: from_utxo[<span class="hljs-string">'txid'</span>],
        <span class="hljs-string">"vout"</span>: from_utxo[<span class="hljs-string">'vout'</span>]
    }]

    outputs = {
        to_address: amount,
        <span class="hljs-string">"找零地址"</span>: from_utxo[<span class="hljs-string">'amount'</span>] - amount - <span class="hljs-number">0.0001</span>  <span class="hljs-comment"># 减去矿工费</span>
    }

    <span class="hljs-keyword">return</span> rpc.createrawtransaction(inputs, outputs)
</code></pre>
<h3 id="完整交易流程">完整交易流程</h3>
<p>详细的交易创建、签名和广播流程请参考：<a href="transaction_examples.py">transaction_examples.py</a></p>
<h2 id="常见问题">常见问题</h2>
<h3 id="❓-为什么比特币不直接记录账户余额？">❓ 为什么比特币不直接记录账户余额？</h3>
<p><strong>技术原因：</strong></p>
<ul>
<li><strong>分布式共识困难</strong>：在分布式网络中，维护全局账户状态需要复杂同步</li>
<li><strong>双重支付防护</strong>：UTXO模型天然防止同一笔钱被花费两次</li>
<li><strong>并行处理能力</strong>：不同UTXO可以并行验证，提高网络效率</li>
</ul>
<p><strong>哲学原因：</strong></p>
<ul>
<li><strong>去中心化原则</strong>：不需要中央机构维护账户状态</li>
<li><strong>透明性</strong>：每笔钱的来源去向完全透明</li>
<li><strong>隐私保护</strong>：可以为每笔交易使用新地址</li>
</ul>
<h3 id="❓-什么是交易延展性？">❓ 什么是交易延展性？</h3>
<p><strong>问题描述：</strong>
交易ID由整个交易内容计算得出，但签名部分可能被恶意修改而不影响交易有效性，导致相同交易有不同ID。</p>
<p><strong>具体例子：</strong></p>
<pre><code>原始交易：TXID = A1B2C3...
恶意修改签名格式：TXID = D4E5F6...
但两个交易都有效且效果相同
</code></pre><p><strong>解决方案：</strong>
SegWit（隔离见证）将签名数据分离，解决了这个问题。</p>
<h3 id="❓-如何计算合适的矿工费？">❓ 如何计算合适的矿工费？</h3>
<p><strong>费用计算公式：</strong></p>
<pre><code>矿工费 = 交易大小(字节) × 费率(聪/字节)
</code></pre><p><strong>动态费率策略：</strong></p>
<pre><code class="lang-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">estimate_fee</span>(<span class="hljs-params">target_confirmations</span>):
    fee_rate = rpc.estimatesmartfee(target_confirmations)
    <span class="hljs-keyword">return</span> fee_rate[<span class="hljs-string">'feerate'</span>]  <span class="hljs-comment"># BTC/KB</span>

<span class="hljs-comment"># 不同优先级的费率</span>
urgent_fee = estimate_fee(<span class="hljs-number">1</span>)    <span class="hljs-comment"># 下个区块确认</span>
normal_fee = estimate_fee(<span class="hljs-number">6</span>)    <span class="hljs-comment"># 1小时内确认  </span>
economy_fee = estimate_fee(<span class="hljs-number">144</span>) <span class="hljs-comment"># 24小时内确认</span>
</code></pre>
<p><strong>典型交易大小：</strong></p>
<ul>
<li>简单P2PKH交易：~225字节</li>
<li>2输入2输出P2PKH：~400字节</li>
<li>SegWit交易：比传统交易小20-40%</li>
</ul>
<h3 id="❓-为什么需要确认？">❓ 为什么需要确认？</h3>
<p><strong>确认过程：</strong></p>
<pre><code>0确认：交易在内存池中
1确认：交易被打包进区块
6确认：交易被6个区块深度保护
</code></pre><p><strong>安全性递增：</strong></p>
<ul>
<li><strong>1确认</strong>：基本安全，适合小额交易</li>
<li><strong>3确认</strong>：中等安全，适合中等金额</li>
<li><strong>6确认</strong>：高安全，交易所和大额交易标准</li>
</ul>
<p><strong>数学原理：</strong>
要逆转一个有n个确认的交易，攻击者需要：</p>
<ul>
<li>控制超过51%的网络算力</li>
<li>重新挖掘从该交易开始的所有后续区块</li>
<li>成本随确认数指数级增长</li>
</ul>
<h3 id="❓-什么是替换交易rbf？">❓ 什么是替换交易(RBF)？</h3>
<p><strong>Replace-By-Fee机制：</strong></p>
<ul>
<li>在交易未确认时，可以发送更高费用的版本</li>
<li>矿工优先打包费用更高的交易</li>
<li>原交易会被新交易替换</li>
</ul>
<p><strong>使用场景：</strong></p>
<pre><code>场景1：费用估算不准确，交易长时间未确认
解决：发送高费用版本，加速确认

场景2：发现转账金额错误
解决：发送更正版本（如果还未确认）
</code></pre><h2 id="结语">结语</h2>
<p>比特币交易系统的设计体现了去中心化系统的智慧：</p>
<h3 id="🏛️-设计哲学">🏛️ 设计哲学</h3>
<ul>
<li><strong>信任最小化</strong>：不依赖任何中央权威</li>
<li><strong>透明可验证</strong>：每笔交易都可独立验证</li>
<li><strong>数学保证</strong>：用密码学而非人类承诺保证安全</li>
<li><strong>经济激励</strong>：矿工费机制确保网络运行</li>
</ul>
<h3 id="🔧-技术特色">🔧 技术特色</h3>
<ul>
<li><strong>UTXO模型</strong>：简单、健壮、并行友好</li>
<li><strong>脚本系统</strong>：灵活、安全、可扩展</li>
<li><strong>费用市场</strong>：动态调节、供需平衡</li>
<li><strong>确认机制</strong>：概率安全、可量化风险</li>
</ul>
<h3 id="🚀-实际价值">🚀 实际价值</h3>
<p>掌握交易基础后，你能够：</p>
<ul>
<li>理解任何比特币钱包的运行原理</li>
<li>开发自己的交易分析工具</li>
<li>优化交易费用和确认时间</li>
<li>为进阶技术（多重签名、SegWit、Taproot）打基础</li>
</ul>
<p>比特币交易不仅仅是技术，更是一种新的价值交换哲学。它证明了：在数学和密码学的基础上，我们可以构建一个不需要信任中介的全球价值网络。</p>
<p>每一笔交易，都是对"代码即法律"理念的实践；每一次验证，都是对去中心化共识的贡献。</p>
<blockquote>
<p>🌟 <strong>完整代码示例</strong>：本章涉及的所有交易操作代码实现请查看：<a href="transaction_examples.py">transaction_examples.py</a></p>
</blockquote>
<hr></hr>
<div align="center">
<a href="https://github.com/beihaili/Get-Started-with-Web3" target="_blank">🏠 返回主页</a> | 
<a href="https://twitter.com/bhbtc1337" target="_blank">🐦 关注作者</a> | 
<a href="https://forms.gle/QMBwL6LwZyQew1tX8" target="_blank">📝 加入交流群</a>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../02_Overview/" class="navigation navigation-prev " aria-label="Previous page: 第02讲：比特币概述">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../04_MultiSig/" class="navigation navigation-next " aria-label="Next page: 第04讲：多重签名交易">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"第03讲：比特币交易基础","level":"5.1","depth":1,"next":{"title":"第04讲：多重签名交易","level":"5.2","depth":1,"path":"GetStartedWithBitcoin/04_MultiSig/README.MD","ref":"GetStartedWithBitcoin/04_MultiSig/README.MD","articles":[]},"previous":{"title":"第02讲：比特币概述","level":"4.2","depth":1,"path":"GetStartedWithBitcoin/02_Overview/README.MD","ref":"GetStartedWithBitcoin/02_Overview/README.MD","articles":[]},"dir":"ltr"},"config":{"plugins":["highlight","fontsettings"],"styles":{"website":"styles/website.css"},"pluginsConfig":{"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"beihaili","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{"version":"完整版","status":"✅ 21个技术章节已完成","chapters":21,"lastUpdate":"2025-09"},"title":"Web3入门指南","language":"zh-hans","gitbook":"*","description":"全面的Web3、区块链和加密货币学习指南，包含21讲比特币技术详解"},"file":{"path":"GetStartedWithBitcoin/03_BitcoinTx/README.MD","mtime":"2025-09-23T02:19:20.576Z","type":"markdown"},"gitbook":{"version":"6.0.3","time":"2025-09-23T02:25:11.154Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/@honkit/honkit-plugin-fontsettings/fontsettings.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/@honkit/honkit-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

